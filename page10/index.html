<!DOCTYPE html>
<html lang="en-us">

  <head>
  <script type="text/javascript">
    var host = "grahamgilbert.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      graham gilbert &middot; Mac administration and assorted nerdity
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <!--link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico"-->

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
  <link href='/stylesheets/all-c8369cf731585eb98eef0098877bca87.css' media='all' rel='stylesheet' type='text/css'>
  <link type="application/atom+xml" rel="alternate" href="https://grahamgilbert.com/atom.xml" title="graham gilbert" />
  <style>
  .clear{
    clear:both
  }
  .float-left {
    float:left;
    padding-right:25px;
    padding-bottom:25px;
  }

  .float-right {
    float:right;
    padding-left:25px;
    padding-bottom:25px;
  }
  </style>
</head>

  <body class="theme-base-0d">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          graham gilbert
        </a>
      </h1>
      <p class="lead">A Mac admin, automating the hell out of things in London.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/talks/">Talks</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
      </nav>
      <p>

      <a href="https://twitter.com/grahamgilbert"><img style="display:inline;" src="/images/social/twitter.png" /></a> <a href="https://github.com/grahamgilbert"><img style="display:inline;" src="/images/social/github.png" /></a> <a href="https://www.linkedin.com/in/grahamgilbert"><img style="display:inline;" src="/images/social/linkedin.png" /></a>
      </p>

    <p>
      <small>The opinions on this site are my own, and are not necessarily shared by my employer.</small>
    </p>

  </div>
</div>

    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2014/07/10/automate-yourself-out-of-a-job/">
        Automate yourself out of a job
      </a>
    </h1>

    <span class="post-date">10 Jul 2014</span>


    
  <p>A massive thanks to everyone who came to my talk today, and thanks to everyone who helped out with the Q&amp;A at the end. All of the code I used in the talk is <a href="https://github.com/grahamgilbert/automate_psu_2014">up on GitHub</a> and <a href="http://grahamgilbert.com/images/posts/2014-07-10/Automate_yourself_out_of_a_job.pdf">here are the slides</a>. Hopefully the video will convey how much fun it actually was - it could have been a disaster, so I’m hugely grateful to everyone who contributed to the discussion at the end.</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2014/07/09/multi-tenanted-munki-with-puppet-and-sal/">
        Multi tenanted Munki with Puppet and Sal
      </a>
    </h1>

    <span class="post-date">09 Jul 2014</span>


    
  <p>Thanks for everyone that came to my talk today, it was fun to finally show off what I’ve been working on for the last year or so. I’m sure the video will be up soon, but in the meantime, <a href="http://grahamgilbert.com/images/posts/2014-07-09/Multi_site_Munki.pdf">here are the slides from the talk</a>.</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2014/06/30/making-packages-with-autopkg/">
        Making packages with AutoPkg
      </a>
    </h1>

    <span class="post-date">30 Jun 2014</span>


    
  <p>Over the past few weeks, I’ve had the same conversation over and over:
people telling me that once they get started using Munki, their next
step will be to start using AutoPkg. I gave each person the same
response: “you’re doing it wrong”.</p>

<p>AutoPkg a has a reputation of being difficult to use. This is totally
unjustfied. You don’t need to be using Munki for it to be useful, you
don’t need to set it up to run automatically via Jenkins or a
LaunchDaemon. If you need to get software into a package,  AutoPkg is
the easiest way.</p>

<h2 id="installing-autopkg">Installing AutoPkg</h2>

<p>Head over to the <a href="https://github.com/autopkg/autopkg/releases/latest">releases page on AutoPkg’s GitHub repository</a> and
download the latest version  (0.3.0 at the time of writing). It’s an
Apple package, so double click it and get it installed. If you have Gate Keeper enabled, you’ll need to right-click on the package and choose to install it from there, as it’s not been signed.</p>

<h2 id="recipes">Recipes</h2>

<p>AutoPkg is useless without recipes. Fortunately, there are hundreds
that have already been made by the community.</p>

<p>We’ll add the set of recipes maintained by AutoPkg’s authors, which
contains some of the most common software. Open up a terminal window
and enter :</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg repo-add https://github.com/autopkg/recipes</div></div></pre></div></figure>

<p>You’ll see AutoPkg downloading and adding the recipes to your Mac.</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">Attempting git clone...
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">Adding /Users/grahamgilbert/Library/AutoPkg/RecipeRepos/com.github.autopkg.recipes to RECIPE_SEARCH_DIRS...
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">Updated search path:
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s1">&#39;.&#39;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s1">&#39;~/Library/AutoPkg/Recipes&#39;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s1">&#39;/Library/AutoPkg/Recipes&#39;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s1">&#39;/Users/vagrant/Library/AutoPkg/RecipeRepos/com.github.autopkg.recipes&#39;</span></div></div></pre></div></figure>

<h2 id="using-the-thing">Using the thing</h2>

<p>Let’s see what recipes we just added. Still in your terminal, enter:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg list-recipes</div></div></pre></div></figure>

<p>You’ll see a whole load of output like:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">Adium.download
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">Adium.munki
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">Adium.pkg
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAIR.pkg
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAcrobatPro9Update.download
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAcrobatPro9Update.munki
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAcrobatProXUpdate.download
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAcrobatProXUpdate.munki
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAir.munki
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeFlashPlayer.download
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeFlashPlayer.munki
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeFlashPlayer.pkg
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeFlashPlayerExtractPackage.munki
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">...</div></div></pre></div></figure>

<p>The naming convention in AutoPKG is SoftwareName.output. For for
example, to run a recipe that downloads Google Chrome and adds it to
Munki, you would use the GoogleChrome.munki recipe, but if you just
wanted to download it an make a package, you’d use the GoogleChrome.pkg recipe. It just so happens that making a package of Chrome is exactly what we want to do.</p>

<p>Back into your terminal and enter:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg run GoogleChrome.pkg</div></div></pre></div></figure>

<p>The AutoPkg robot will churn away and you’ll get some output similar to:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">Processing GoogleChrome.pkg...
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">The following new items were downloaded:
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    /Users/grahamgilbert/Library/AutoPkg/Cache/com.github.autopkg.pkg.googlechrome/downloads/GoogleChrome.dmg
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">The following packages were built:
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    Identifier               Version          Pkg path                        
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    ----------               -------          --------                        
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    com.google.Chrome        35.0.1916.153    /Users/grahamgilbert/Library/AutoPkg/Cache/com.github.autopkg.pkg.googlechrome/GoogleChrome-35.0.1916.153.pkg</div></div></pre></div></figure>

<p>And when it’s all finished, you’ll be left with a nice package that
you can use anywhere you’d use finely crafted packages - ARD, AutoDMG or even Casper if you’re that way inclined (although Allister Banks has been
working on a way of automating importing packages into the JSS - see
his <a href="http://tmblr.co/ZHT_Wy1J-Hk5I">recent talk</a> for more on that subject).</p>

<h2 id="doing-it-all-again">Doing it all again</h2>

<p>What happens next time you want to build an updated package?</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg run GoogleChrome.pkg</div></div></pre></div></figure>

<p>Right?</p>

<p>Well, kinda.</p>

<p>What happens if Google changes the URL AutoPkg uses to download
Chrome? Fortunately we’re using the community provided recipes, and if
something’s broken they usually get fixed pretty quickly. We just need
to tell AutoPkg to update the installed recipes.</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg update-repo all</div></div></pre></div></figure>

<p>And then we’re able to build our package safe in the knowledge that
someone else has done all of the hard work for us.</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2014/05/19/deploying-sal-on-heroku/">
        Deploying Sal on Heroku
      </a>
    </h1>

    <span class="post-date">19 May 2014</span>


    
  <p>Setting up everything you need for Sal can be difficult, especially if you only have an OS X server available. Thankfully, Sal is built on top of a very common Python framework, Django. And even more thankfully, you can run Django on a whole host of <a href="http://en.wikipedia.org/wiki/Platform_as_a_service">PaaS</a> providers, including <a href="https://www.heroku.com">Heroku</a>.</p>

<p>Heroku has a very generous <a href="https://www.heroku.com/pricing">free tier</a> that will easily handle a small Sal installation, so let’s get started.</p>

<h2 id="heroku-toolbelt">Heroku toolbelt</h2>

<p>If you’ve never used Heroku before, you’re going to need to head over to <a href="http://heroku.com">their site</a> and sign up for a free account. Whilst you’re there, you’re also going to need to install their toolbelt. <a href="http://toolbelt.herokuapp.com/">Grab the package</a> and follow their instructions for linking it to your account.</p>

<h2 id="configure">Configure</h2>

<p>Now we need to get a copy of Sal and configure it. Assuming you keep your code in ~/src:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span><span class="nb">cd</span> ~/src
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>git clone https://github.com/grahamgilbert/sal
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span><span class="nb">cd </span>sal</div></div></pre></div></figure>

<p>Now we need to make a copy of sal/example_settings.py</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>cp sal/example_settings.py sal/settings.py</div></div></pre></div></figure>

<p>And edit sal/settings.py in your favourite editor to your liking (probably time zone at least).</p>

<p>Heroku uses git for deployment, so we need to commit our changes.</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>git add .
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>git commit -m <span class="s2">&quot;initial commit to heroku&quot;</span></div></div></pre></div></figure>

<p>We’re nearly there! Time to create our environment on Heroku</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>heroku create</div></div></pre></div></figure>

<p>Of course we haven’t pushed Sal to Heroku yet. Let’s fix that.</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>git push heroku master</div></div></pre></div></figure>

<p>You’ll see Sal being pushed up to Heroku and Sal’s requirements being installed. A Postgres database will also automatically be created for you. The database will be empty though, so let’s populate it with what we need.</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>heroku run python manage.py syncdb</div></div></pre></div></figure>

<p>When asked, you certainly <em>do</em> want to create a super user. Use a strong username and password as this is the admin for your Sal application.</p>

<p>One last command to run:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>heroku run python manage.py migrate</div></div></pre></div></figure>

<p>Your Sal installation is ready to use:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>heroku open</div></div></pre></div></figure>

<p>As said earlier, the free version does have some limits. The most important with Sal is the number of rows you can have in the free database (10,000), so the more information you collect from each machine (Facter Facts and Munki Conditions), the larger your database is. It’s a measley $9 a month to upgrade your database to 10 million rows, so it’s easy to scale your database. For more information on upgrading your Heroku environment see <a href="https://devcenter.heroku.com/articles/upgrade-heroku-postgres-with-pgbackups">their documentation</a>.</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2014/04/21/first-boot-pkg/">
        first-boot-pkg
      </a>
    </h1>

    <span class="post-date">21 Apr 2014</span>


    
  <p>There are some packages that can’t be deployed to an unbooted OS, such as when building an image with AutoDMG. If you are using Greg Neagle’s <a href="http://managingosx.wordpress.com/2012/07/25/son-of-installlion-pkg/">createOSXinstallPkg</a>, the OS X installer environment doesn’t have everything a full OS X install has. For times like this, you need to install the packages at first boot. For a long time, I’ve used Rich Trouton’s <a href="http://derflounder.wordpress.com/2014/04/17/first-boot-package-install-revisited/">First Boot Package Install</a>, however I found myself repeating things quite a bit and having a folder full of first boot packages.</p>

<p>So, I made my own. The main features of <a href="https://github.com/grahamgilbert/first-boot-pkg">first-boot-pkg</a> are:</p>

<ul>
  <li>It is designed with scripting and automation in mind, with options able to be configured with a configuration plist or via options on the command line (or a mixture of both)</li>
  <li>It will re-try failed packages a specified number of times (in case of Active Directory not being available, for example)</li>
  <li>Will wait for the network to be available before installing (optional, can be disabled if desired just in case your package is going to let the Mac get onto the network)</li>
</ul>

<p><a href="/images/posts/2014-04-21/first-boot-pkg.png"><img class="center" src="/images/posts/2014-04-21/first-boot-pkg.png" width="578" height="433" /></a></p>

<p>If you’re happy with using Git, I’d recommend just making a clone of the repository and doing a <code>git pull</code> to keep the script updated. If the thought of all those gits and pulls makes you run away, you can <a href="https://github.com/grahamgilbert/first-boot-pkg/archive/master.zip">download a zip</a> of the project.</p>

<p>This script makes use of Per Olofsson’s <a href="https://github.com/MagerValp/LoginLog">LoginLog</a> for displaying the log file whilst the script is running, so massive thanks to him for releasing it.</p>


  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page11">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page9">Newer</a>
    
  
</div>

    </div>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27233739-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
