
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>graham gilbert</title>
  <meta name="author" content="Graham Gilbert">

  
  <meta name="description" content="Puppet is awesome. Until you deploy some code that worked locally, but for some reason didn’t when you put it onto your Puppet Master. Whoops. So, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://grahamgilbert.com/blog/page/10">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="graham gilbert" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@grahamgilbert">
<meta name="twitter:creator" content="@grahamgilbert">
<meta name="twitter:description" content="Mac administration and assorted nerdity">
<meta name="twitter:title" content="grahamgilbert.com">
<meta name="twitter:url" content="http://grahamgilbert.com">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27233739-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">graham gilbert</a></h1>
  
    <h2>Mac administration and assorted nerdity</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:grahamgilbert.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/talks">Talks</a></li>
  <li><a href="http://twitter.com/grahamgilbert">Twitter</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/13/building-a-test-puppet-master-with-vagrant/">Building a Test Puppet Master With Vagrant</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-13T08:27:00+00:00" pubdate data-updated="true">Feb 13<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/13/building-a-test-puppet-master-with-vagrant/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Puppet is awesome. Until you deploy some code that worked locally, but for some reason didn’t when you put it onto your Puppet Master. Whoops.</p>

<p>So, you need a testing setup. But Puppet can take a while to keep configuring. Which is where <a href="http://www.vagrantup.com">Vagrant</a> comes in. It it a tool which allows you to build virtual machines automatically (currently only with VirtualBox, but VMWare Fusion support is coming very soon). And the best part (for me, anyway) is that it uses Puppet to configure the VM (Puppet to configure your Puppet Master? All too meta for this time of the morning).</p>

<p>Anyway, that’s enough waffle &ndash; the Vagrant configuration is up on my <a href="https://github.com/grahamgilbert/vagrant-puppetmaster">GitHub</a>.</p>

<p>If you are following along with my series on getting started with Puppet on OS X, you can replace the Puppet Labs provided VM with this setup (which would be a good idea, as the Enterprise version is a few versions behind the Open Source version, missing some features when managing Macs).</p>

<p>This testing setup includes:</p>

<ul>
<li>A Puppet Master running using the built in web server (fine for testing, not enough poke for a production server)</li>
<li>Puppet Dashboard (we all love a GUI, right?)</li>
<li>PuppetDB (this will store data about your nodes, and then hooks into the Dashboard to display it)</li>
</ul>


<p>To get up and running quickly, you will need:</p>

<ul>
<li><a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a></li>
<li><a href="http://downloads.vagrantup.com/">Vagrant</a></li>
</ul>


<p>Once those are installed, cd into the directory where you keep your code (mine lives in ~/Documents/Code), clone the repo and then tell Vagrant to bring the VM up.</p>

<pre><code>cd ~/Documents/Code
git clone https://github.com/grahamgilbert/vagrant-puppetmaster.git
cd vagrant-puppetmaster
vagrant up
</code></pre>

<p>If you don’t have the base box Ubuntu box downloaded, Vagrant will pull it down for you and cache the clean VM for you. It will then make a copy, run the script that installs the latest version of Puppet, then run through the Puppet code that will configure the VM to be a Puppet Master for you. Once the VM is running, you can place your modules and manifests in <code>puppet/modules</code> and <code>puppet/manifests</code>, respectively. The dashboard is accessible at <a href="http://192.168.33.10:3000">http://192.168.33.10:3000</a>.</p>

<p><strong>This VM is not suitable for production.</strong> I’ve made several tweaks to the configuration that makes it easier to test your code, but would be a security risk if used on a production server. <strong>Only use this configuration for testing.</strong> We’re also installing everything onto one VM &ndash; you probably want to separate this out into at least two boxes in production, maybe even three if you have a large deployment. Like I said, the idea here is to quickly set up a testing environment that behaves like our production environment.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/27/getting-started-with-puppet-on-os-x-part-2/">Getting Started With Puppet on OS X (Part 2)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-27T09:30:00+00:00" pubdate data-updated="true">Jan 27<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/27/getting-started-with-puppet-on-os-x-part-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Before reading this post, you really need to read <a href="http://grahamgilbert.com/blog/2013/01/25/getting-started-with-puppet-part-1/">part 1</a> &ndash; none of this will make sense without it!</p>

<p>Still with me? Let&rsquo;s do finally do something with Puppet. SSH into your Puppet Master (if it&rsquo;s IP has changed since you first did the setup, make sure you reflect this change in the Mac client&rsquo;s /etc/hosts file) and navigate to /etc/puppet and list the directory&rsquo;s contents:</p>

<pre><code>cd /etc/puppet
ls -la
</code></pre>

<p>You&rsquo;ll see a few directories here &ndash; we&rsquo;re interested in two today &ndash; manifests and modules. Manifests will be where you describe your nodes, and the modules are the functional Puppet code.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/01/27/getting-started-with-puppet-on-os-x-part-2/">Continue reading &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/25/getting-started-with-puppet-part-1/">Getting Started With Puppet on OS X (Part 1)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-25T21:22:00+00:00" pubdate data-updated="true">Jan 25<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/25/getting-started-with-puppet-part-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I was first getting started, the first hurdle I had to get over was trying to work out how it would apply to what I do &ndash; manage Macs. There are plenty of resources on managing servers with Puppet, but precious little on using Puppet with OS X &ndash; so, here&rsquo;s how to get started with Puppet.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/01/25/getting-started-with-puppet-part-1/">Continue reading &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/18/crypt-a-filevault-2-escrow-solution/">Crypt: A FileVault 2 Escrow Solution</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-18T08:05:00+00:00" pubdate data-updated="true">Jan 18<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/18/crypt-a-filevault-2-escrow-solution/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Although it&rsquo;s been blogged about over at <a href="http://afp548.com/2013/01/02/crypt-a-client-and-web-app-for-filevault-2-encryption-and-escrow/">afp548</a> and <a href="http://derflounder.wordpress.com/2012/12/31/first-look-at-crypt/">Rich Trouton&rsquo;s blog</a>, I&rsquo;d like to introduce you all to <a href="https://github.com/grahamgilbert/Crypt">Crypt</a>.</p>

<p><img class="center" src="/images/posts/2013-01-18/Crypt-Screenshot.png"></p>

<p>Crypt is a solution for enabling FileVault 2 on Macs running either 10.7 or 10.8 and securely storing those keys, using no outside infrastructure like other solutions do (Cauliflower Vest&rsquo;s requirement of Google App Engine). It&rsquo;s only requirement is a web server that can run a Django app (which is pretty much anything &ndash; the example setup uses Apache on Ubuntu 12, but you can use anything you want).</p>

<p>Crypt is made up of two parts: A <a href="https://github.com/grahamgilbert/Crypt-Server">web app</a>, which stores the recovery keys and a <a href="https://github.com/grahamgilbert/Crypt">client app</a> for enabling FileVault 2 on a Mac which then sends the recovery key to the server. The server has two user levels, so access to keys can be restricted, and all key access is logged for auditing.</p>

<p>We&rsquo;ve been using it at <a href="http://pebbleit.com">pebble.it</a> for a few weeks now and haven&rsquo;t found any issues during use, but please be aware that this is what I&rsquo;d call &ldquo;beta&rdquo; software. You might be happy using beta software in production, but that&rsquo;s up to you! I&rsquo;d welcome all feedback, both good and bad. Planned features include AD authentication and emails to admins when new requests come in. Please file bugs and feature requests over at <a href="https://github.com/grahamgilbert/Crypt">GitHub</a> so I can keep track of them all.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/13/casper-vs-munki/">Casper vs Munki</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-13T21:34:00+00:00" pubdate data-updated="true">Jan 13<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/13/casper-vs-munki/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Next up in the battle of Casper vs the rest of the Mac admin toolset looking to reign supreme in the contest of software installation is Munki.</p>

<h2>Setup</h2>

<p>The setup process for a Munki server can seem to be very daunting at first if you&rsquo;ve not configured a web server before. If you are happy setting one up, it&rsquo;s the easiest server install you&rsquo;ll ever do! Munki&rsquo;s requirement of just a basic web server means it can run on literally anything (although Casper will also run on anything you&rsquo;re likely to use &ndash; I&rsquo;ve had both running on Windows boxes for example).</p>

<p>The setup of a Casper server can be quite involved, but chances are if you don&rsquo;t know what you&rsquo;re doing, it&rsquo;s already been done for you during your jump start.</p>

<p>Winner: Casper &ndash; if you&rsquo;ve paid for the Casper Suite, you&rsquo;re ready to go after your jump start (in theory!). That being said, there are people who can configure Munki for you if you need it (<a href="http://pebbleit.com">shameless plug for my employers here!</a>)</p>

<h2>Getting software into the system</h2>

<p>A streamlined workflow for Munki takes a little setup. Our Munki repository lives on an Ubuntu box, with the actual repo being shared out via SMB. This could just as easily be configured on a Windows server or an OS X server if you still have them in your server room.</p>

<p>With the sharepoint set up, I can just mount the repo and then run munkiimport to get the software into Munki. Yes, a lot of people will be put off with having to use a command line interface &ndash; thats something all Mac admins will need to get over at some point in their career, it might as well be now!</p>

<p>Casper&rsquo;s method of getting software into the system is simple, but incredibly long winded. You seem to be expected to repackage nearly everything, which is a major pain in the ass. Your JAMF rep will point you towards the pre-made templates in Composer &ndash; ironically, most of the apps listed in there, shouldn&rsquo;t need repackaging in the first place as they&rsquo;re either distributed in reasonable packages (like Office) or have tools available to make a package (like Creative Suite).  Once you&rsquo;ve got the package, it&rsquo;s super simple to get the package into Casper &ndash; crack open Casper Admin and drag the package into it. You need to then make a policy which somehow installs the software (more on that in the next section).</p>

<p>Winner: Draw. Munki is more work up front, and doesn&rsquo;t have a GUI which will be an issue for some. Casper is really easy to use, but a complete faff every time you need to get new software onto your macs. You shouldn&rsquo;t need to repackage. Ever. Especially for drag and drop app installations.</p>

<h2>Configuration options</h2>

<p>The two systems are fairly feature comparable (pre and post flight scripts, ways to limit who gets what software etc), but it&rsquo;s how they present those options to the admin that differentiates them.</p>

<p>Let&rsquo;s take a common example: installing an Office 2011 update. We have the 14.2.5 update that requires the installation to be at 14.2.3 to start off with.
Some might be, others won&rsquo;t for one reason or another.</p>

<p>We&rsquo;ve already got the packages in our respective systems &ndash; let&rsquo;s start off with Casper. We need to differentiate the macs that need the update first &ndash; we&rsquo;ll do this with a smart group. We make a smart group that has Word at version 14.2.3 and apply the policy to that- great, done right? But what about those users that slipped through the net and only have 14.2?  So at that point you need to refine your smart group to target a range of versions. You also need to change this <em>every time there&rsquo;s an update</em>. If you only have Office to worry about this might not be too much of a problem, but as soon as you get a few more packages to look after, this rapidly becomes tedious.</p>

<p>Lets look at the same scenario Munki. I just need to mark the update as being an update for Office 2011 (this direct relationship between software and delta updates doesn&rsquo;t exist within Casper) and that the update requires a particular version of Office to be installed within it&rsquo;s pkginfo file &ndash; two minutes work in a text editor at worst once you know the syntax.</p>

<p>Winner: Munki &ndash; the direct relationship between updates and their parent package is invaluable. As ever, Munki is a lot more work up front, but it pays off in a much easier workflow after that.</p>

<h2>Installing software on client machines</h2>

<p>By default, this is what a client sees when Munki wants to install something:</p>

<p><img src="/images/posts/2013-01-13/Munki.png"></p>

<p>And this is what you see with Casper.</p>

<p><img src="/images/posts/2013-01-13/Blank_Desktop.png"></p>

<p>No, I&rsquo;ve not made a mistake. No warning, no option to delay to a more convenient time, nothing. Nada. Zilch. And you better hope that the app isn&rsquo;t running! It&rsquo;s crash time otherwise.</p>

<p>Munki will warn the user when apps you want to update are running, will warn them when a forced install is coming (several times), will let the user know that a reboot will be needed <em>before</em> the software gets installed.</p>

<p>I know that these things can be done with Casper, I had a demo from a nice chap from JAMF during the week showing me all of this (as a side note, kudos to JAMF for reaching out to me following my last post in this). The issue is, I don&rsquo;t particularly want to write a bash script ever time I deploy software to check if the app is running, warn the user etc etc. We spend on average an hour a week updating our Munki repo &ndash; I dread to think how long it would take if I had to do that level of scripting for each package.</p>

<p>The one place Casper does excel on the client side is Self Service. The pretty icons and familiar app store look are much easier for end users to use than Munki&rsquo;s optional installs &ndash; that being said, optional installs with Munki aren&rsquo;t exactly hard to use.</p>

<p>Winner: Munki &ndash; someone at JAMF told me their goal is to make administrators lives easier. Unfortunately my goal is to make my client&rsquo;s mac experience as awesome as possible, and random reboots with only five minute warnings aren&rsquo;t exactly awesome in my book.</p>

<h2>Reporting</h2>

<p>This is the area where Casper excels. Out of the box, the reporting is fantastic. You know who has installed what, when, how many licenses you have left, pretty much anything you need to now is there out of the box.</p>

<p>Munki does have MunkiWebAdmin, but it&rsquo;s an extra install, and can be quite tricky if you&rsquo;re not used to configuring a Django app. It does provide a fair bit of info on what&rsquo;s happening with your Munki-d macs, but nowhere near what you&rsquo;d get out of Casper. The stats you can get out of Casper are truly immense.</p>

<h2>Auditing Admin actions</h2>

<p>This should really come with the post when Casper goes head to head with Puppet, but it affected me in real life a couple of weeks ago, so it can come in today. I came to a Casper install and noticed that the policy that was due to install an Office update had been deleted. Had this happened with our Munki setup, we would just look at the Git history (you are using Git to track your Munki config, right?), see who made the change, find out why, and roll it back if needed.</p>

<p>In this particular instance, I had no idea if it had been done by mistake or on purpose by their internal IT team. I raised this is JAMF this week, and was shown the database log. Whilst this is better than nothing at all, it&rsquo;s still woefully inadequate for a solution that is marketed at the enterprise.</p>

<p>Winner &ndash; Munki (or any solution that can have its history tracked effectively)</p>

<p>So for those who stopped keeping count, Munki pips it. On the face of it, depending on your priorities, it&rsquo;s quite a close thing. But as my clients pay my wages, the user experience is of paramount importance to me, so personally, Munki is a clear winner. If my users aren&rsquo;t able to work, they can&rsquo;t earn money. If they can&rsquo;t earn money, they can&rsquo;t pay their IT bill.</p>

<p>Munki offers the greatest flexibility between letting users carry on with their work when there&rsquo;s a not so important update until it&rsquo;s convenient for them to stop and forcing the update (but still warning them appropriately) when it&rsquo;s critical.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/11/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/9/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About</h1>
  <p><img src="/images/me.jpg" class="left" />A Mac admin, automating the hell out of things in London. <a href="/about">More?</a></p>

<p class="clear"><small>The opinions on this site are my own, and are not necessarily shared by my employer.</small></p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/10/using-the-sal-api/">Using the Sal API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/07/munki-dnd/">Munki DND</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/26/the-future-of-sal/">The Future of Sal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/24/running-puppet-server-in-docker-part-2-r10k/">Running Puppet Server in Docker Part 2: R10k</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/22/running-puppet-server-in-docker/">Running Puppet Server in Docker</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/grahamgilbert">@grahamgilbert</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'grahamgilbert',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Twitter</h1>
<a class="twitter-timeline" href="https://twitter.com/grahamgilbert" data-widget-id="483550747481489408">Tweets by @grahamgilbert</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Graham Gilbert -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'grahamgilbert';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
