<div class="post">
  <h1 class="post-title">Making packages with AutoPkg</h1>
  <span class="post-date">30 Jun 2014</span>
  <p>Over the past few weeks, I’ve had the same conversation over and over:
people telling me that once they get started using Munki, their next
step will be to start using AutoPkg. I gave each person the same
response: “you’re doing it wrong”.</p>

<p>AutoPkg a has a reputation of being difficult to use. This is totally
unjustfied. You don’t need to be using Munki for it to be useful, you
don’t need to set it up to run automatically via Jenkins or a
LaunchDaemon. If you need to get software into a package,  AutoPkg is
the easiest way.</p>

<h2 id="installing-autopkg">Installing AutoPkg</h2>

<p>Head over to the <a href="https://github.com/autopkg/autopkg/releases/latest">releases page on AutoPkg’s GitHub repository</a> and
download the latest version  (0.3.0 at the time of writing). It’s an
Apple package, so double click it and get it installed. If you have Gate Keeper enabled, you’ll need to right-click on the package and choose to install it from there, as it’s not been signed.</p>

<h2 id="recipes">Recipes</h2>

<p>AutoPkg is useless without recipes. Fortunately, there are hundreds
that have already been made by the community.</p>

<p>We’ll add the set of recipes maintained by AutoPkg’s authors, which
contains some of the most common software. Open up a terminal window
and enter :</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg repo-add https://github.com/autopkg/recipes</div></div></pre></div></figure>

<p>You’ll see AutoPkg downloading and adding the recipes to your Mac.</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">Attempting git clone...
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">Adding /Users/grahamgilbert/Library/AutoPkg/RecipeRepos/com.github.autopkg.recipes to RECIPE_SEARCH_DIRS...
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">Updated search path:
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s1">&#39;.&#39;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s1">&#39;~/Library/AutoPkg/Recipes&#39;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s1">&#39;/Library/AutoPkg/Recipes&#39;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="s1">&#39;/Users/vagrant/Library/AutoPkg/RecipeRepos/com.github.autopkg.recipes&#39;</span></div></div></pre></div></figure>

<h2 id="using-the-thing">Using the thing</h2>

<p>Let’s see what recipes we just added. Still in your terminal, enter:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg list-recipes</div></div></pre></div></figure>

<p>You’ll see a whole load of output like:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">Adium.download
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">Adium.munki
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">Adium.pkg
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAIR.pkg
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAcrobatPro9Update.download
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAcrobatPro9Update.munki
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAcrobatProXUpdate.download
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAcrobatProXUpdate.munki
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeAir.munki
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeFlashPlayer.download
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeFlashPlayer.munki
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeFlashPlayer.pkg
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">AdobeFlashPlayerExtractPackage.munki
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">...</div></div></pre></div></figure>

<p>The naming convention in AutoPKG is SoftwareName.output. For for
example, to run a recipe that downloads Google Chrome and adds it to
Munki, you would use the GoogleChrome.munki recipe, but if you just
wanted to download it an make a package, you’d use the GoogleChrome.pkg recipe. It just so happens that making a package of Chrome is exactly what we want to do.</p>

<p>Back into your terminal and enter:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg run GoogleChrome.pkg</div></div></pre></div></figure>

<p>The AutoPkg robot will churn away and you’ll get some output similar to:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">Processing GoogleChrome.pkg...
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">The following new items were downloaded:
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    /Users/grahamgilbert/Library/AutoPkg/Cache/com.github.autopkg.pkg.googlechrome/downloads/GoogleChrome.dmg
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">The following packages were built:
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    Identifier               Version          Pkg path                        
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    ----------               -------          --------                        
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    com.google.Chrome        35.0.1916.153    /Users/grahamgilbert/Library/AutoPkg/Cache/com.github.autopkg.pkg.googlechrome/GoogleChrome-35.0.1916.153.pkg</div></div></pre></div></figure>

<p>And when it’s all finished, you’ll be left with a nice package that
you can use anywhere you’d use finely crafted packages - ARD, AutoDMG or even Casper if you’re that way inclined (although Allister Banks has been
working on a way of automating importing packages into the JSS - see
his <a href="http://tmblr.co/ZHT_Wy1J-Hk5I">recent talk</a> for more on that subject).</p>

<h2 id="doing-it-all-again">Doing it all again</h2>

<p>What happens next time you want to build an updated package?</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg run GoogleChrome.pkg</div></div></pre></div></figure>

<p>Right?</p>

<p>Well, kinda.</p>

<p>What happens if Google changes the URL AutoPkg uses to download
Chrome? Fortunately we’re using the community provided recipes, and if
something’s broken they usually get fixed pretty quickly. We just need
to tell AutoPkg to update the installed recipes.</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">$ </span>autopkg update-repo all</div></div></pre></div></figure>

<p>And then we’re able to build our package safe in the knowledge that
someone else has done all of the hard work for us.</p>

</div>

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//grahamgilbert.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/2017/01/19/pocket-mac-admins-guide-to-london/">
            Pocket Mac admin's guide to London
            <small>19 Jan 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2017/01/11/imagr-with-target-disk-mode/">
            Imagr with target disk mode
            <small>11 Jan 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/12/15/enable-sip-with-munki/">
            Enable SIP with Munki
            <small>15 Dec 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
