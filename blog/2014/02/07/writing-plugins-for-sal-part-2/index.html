<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Writing Plugins for Sal: Part 2 &#8211; graham gilbert dot com</title>
<meta name="description" content="And now, time for the shocking second part of our series on how to write plugins for Sal.

In the previous part, we got our basic widget working. This time, we’re going to link it up so we can get lists of those pesky non-10.9 compatible Macs when we click on the button.

It’s a list, Jim

When displaying the list of machines, Sal will call the filter_machines function in your plugin. I’m sure you don’t want to disappoint, so here’s that function added on to the plugin we wrote last time.

grahamgilbert/mavcompatibility/mavcompatibility.pyfrom yapsy.IPlugin import IPlugin
from yapsy.PluginManager import PluginManager
from django.template import loader, Context
from django.db.models import Count
from server.models import *
 class MavCompatibility(IPlugin):
    def show_widget(self, page, machines=None, theid=None):
         if page == &#39;front&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/front.html&#39;)
         if page == &#39;bu_dashboard&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/id.html&#39;)
         if page == &#39;group_dashboard&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/id.html&#39;)
          not_compatible = machines.filter(condition__condition_name=&#39;supported_major_os_upgrades&#39;).exclude(condition__condition_name=&#39;supported_major_os_upgrades&#39;, condition__condition_data__contains=&#39;10.9&#39;).count()
         c = Context(&#x7b;
            &#39;title&#39;: &#39;10.9 Compatibility&#39;,
            &#39;not_compatible&#39;: not_compatible,
            &#39;page&#39;: page,
            &#39;theid&#39;: theid
        &#x7d;)
        return t.render(c), 3
     def filter_machines(self, machines, data):
        if data == &#39;notcompatible&#39;:
            machines = machines.filter(condition__condition_name=&#39;supported_major_os_upgrades&#39;).exclude(condition__condition_name=&#39;supported_major_os_upgrades&#39;, condition__condition_data__contains=&#39;10.9&#39;)
            title = &#39;Macs not compatible with OS X 10.9&#39;
        else:
            machines = None
            title = None
         return machines, title

You’ll notice that our filter on the machines is pretty much identical to what we were looking for before - that’s because we’re looking for the same machines. We’re taking some input (a bunch of machines, and a string that we’ll come back to), and giving back the machine that fit our search and a title to show at the top of the page.

More templating

So, how did we pass that string? How do we even get to the page where a list of the machines is shown?

We need to edit the templates. First off, the template that is show on the front page of Sal:

grahamgilbert/mavcompatibility/templates/front.html&lt;div class=&quot;span3&quot;&gt;
    &lt;legend&gt;&#x7b;&#x7b; title &#x7d;&#x7d;&lt;/legend&gt;
        &lt;a href=&quot;&#x7b;% url &#39;machine_list_front&#39; &#39;MavCompatibility&#39; &#39;notcompatible&#39; %&#x7d;&quot; class=&quot;btn btn-danger&quot;&gt;
            &lt;span class=&quot;bigger&quot;&gt; &#x7b;&#x7b; not_compatible &#x7d;&#x7d; &lt;/span&gt;&lt;br /&gt;
            Not Compatible
        &lt;/a&gt;
&lt;/div&gt;

The only difference here from last time is we’ve filled out the URL. The options for the first part are machine_list_front or machine_list_id - depending on whether you are coming from the front page (all of the Business Units) or from deeper in the application (the machines are limited), then we’re just passing the name of our plugin.

There isn’t a huge amount you need to change for the other template - just tell Sal what type of page you came from (group or business unit) and the ID of the page you came from.

grahamgilbert/mavcompatibility/templates/id.html&lt;div class=&quot;span3&quot;&gt;
    &lt;legend&gt;&#x7b;&#x7b; title &#x7d;&#x7d;&lt;/legend&gt;
        &lt;a href=&quot;&#x7b;% url &#39;machine_list_id&#39; &#39;MavCompatibility&#39; &#39;notcompatible&#39; page theid %&#x7d;&quot; class=&quot;btn btn-danger&quot;&gt;
            &lt;span class=&quot;bigger&quot;&gt; &#x7b;&#x7b; not_compatible &#x7d;&#x7d; &lt;/span&gt;&lt;br /&gt;
            Not Compatible
        &lt;/a&gt;
&lt;/div&gt;

There you go - a simple plugin for Sal. But don’t go away thinking we’re done. Whilst this is functional, it certainly leaves a fair bit to be desired. In the last part of this series, we’ll tidy everything up.

">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Writing Plugins for Sal: Part 2">
<meta name="twitter:description" content="And now, time for the shocking second part of our series on how to write plugins for Sal.

In the previous part, we got our basic widget working. This time, we’re going to link it up so we can get lists of those pesky non-10.9 compatible Macs when we click on the button.

It’s a list, Jim

When displaying the list of machines, Sal will call the filter_machines function in your plugin. I’m sure you don’t want to disappoint, so here’s that function added on to the plugin we wrote last time.

grahamgilbert/mavcompatibility/mavcompatibility.pyfrom yapsy.IPlugin import IPlugin
from yapsy.PluginManager import PluginManager
from django.template import loader, Context
from django.db.models import Count
from server.models import *
 class MavCompatibility(IPlugin):
    def show_widget(self, page, machines=None, theid=None):
         if page == &#39;front&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/front.html&#39;)
         if page == &#39;bu_dashboard&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/id.html&#39;)
         if page == &#39;group_dashboard&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/id.html&#39;)
          not_compatible = machines.filter(condition__condition_name=&#39;supported_major_os_upgrades&#39;).exclude(condition__condition_name=&#39;supported_major_os_upgrades&#39;, condition__condition_data__contains=&#39;10.9&#39;).count()
         c = Context(&#x7b;
            &#39;title&#39;: &#39;10.9 Compatibility&#39;,
            &#39;not_compatible&#39;: not_compatible,
            &#39;page&#39;: page,
            &#39;theid&#39;: theid
        &#x7d;)
        return t.render(c), 3
     def filter_machines(self, machines, data):
        if data == &#39;notcompatible&#39;:
            machines = machines.filter(condition__condition_name=&#39;supported_major_os_upgrades&#39;).exclude(condition__condition_name=&#39;supported_major_os_upgrades&#39;, condition__condition_data__contains=&#39;10.9&#39;)
            title = &#39;Macs not compatible with OS X 10.9&#39;
        else:
            machines = None
            title = None
         return machines, title

You’ll notice that our filter on the machines is pretty much identical to what we were looking for before - that’s because we’re looking for the same machines. We’re taking some input (a bunch of machines, and a string that we’ll come back to), and giving back the machine that fit our search and a title to show at the top of the page.

More templating

So, how did we pass that string? How do we even get to the page where a list of the machines is shown?

We need to edit the templates. First off, the template that is show on the front page of Sal:

grahamgilbert/mavcompatibility/templates/front.html&lt;div class=&quot;span3&quot;&gt;
    &lt;legend&gt;&#x7b;&#x7b; title &#x7d;&#x7d;&lt;/legend&gt;
        &lt;a href=&quot;&#x7b;% url &#39;machine_list_front&#39; &#39;MavCompatibility&#39; &#39;notcompatible&#39; %&#x7d;&quot; class=&quot;btn btn-danger&quot;&gt;
            &lt;span class=&quot;bigger&quot;&gt; &#x7b;&#x7b; not_compatible &#x7d;&#x7d; &lt;/span&gt;&lt;br /&gt;
            Not Compatible
        &lt;/a&gt;
&lt;/div&gt;

The only difference here from last time is we’ve filled out the URL. The options for the first part are machine_list_front or machine_list_id - depending on whether you are coming from the front page (all of the Business Units) or from deeper in the application (the machines are limited), then we’re just passing the name of our plugin.

There isn’t a huge amount you need to change for the other template - just tell Sal what type of page you came from (group or business unit) and the ID of the page you came from.

grahamgilbert/mavcompatibility/templates/id.html&lt;div class=&quot;span3&quot;&gt;
    &lt;legend&gt;&#x7b;&#x7b; title &#x7d;&#x7d;&lt;/legend&gt;
        &lt;a href=&quot;&#x7b;% url &#39;machine_list_id&#39; &#39;MavCompatibility&#39; &#39;notcompatible&#39; page theid %&#x7d;&quot; class=&quot;btn btn-danger&quot;&gt;
            &lt;span class=&quot;bigger&quot;&gt; &#x7b;&#x7b; not_compatible &#x7d;&#x7d; &lt;/span&gt;&lt;br /&gt;
            Not Compatible
        &lt;/a&gt;
&lt;/div&gt;

There you go - a simple plugin for Sal. But don’t go away thinking we’re done. Whilst this is functional, it certainly leaves a fair bit to be desired. In the last part of this series, we’ll tidy everything up.

">
<meta name="twitter:site" content="@grahamgilbert">
<meta name="twitter:creator" content="@grahamgilbert">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://grahamgilbert.com/images/about.jpg">

<!-- Open Graph -->
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="article">
<meta property="og:title" content="Writing Plugins for Sal: Part 2">
<meta property="og:description" content="And now, time for the shocking second part of our series on how to write plugins for Sal.

In the previous part, we got our basic widget working. This time, we’re going to link it up so we can get lists of those pesky non-10.9 compatible Macs when we click on the button.

It’s a list, Jim

When displaying the list of machines, Sal will call the filter_machines function in your plugin. I’m sure you don’t want to disappoint, so here’s that function added on to the plugin we wrote last time.

grahamgilbert/mavcompatibility/mavcompatibility.pyfrom yapsy.IPlugin import IPlugin
from yapsy.PluginManager import PluginManager
from django.template import loader, Context
from django.db.models import Count
from server.models import *
 class MavCompatibility(IPlugin):
    def show_widget(self, page, machines=None, theid=None):
         if page == &#39;front&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/front.html&#39;)
         if page == &#39;bu_dashboard&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/id.html&#39;)
         if page == &#39;group_dashboard&#39;:
            t = loader.get_template(&#39;grahamgilbert/mavcompatibility/templates/id.html&#39;)
          not_compatible = machines.filter(condition__condition_name=&#39;supported_major_os_upgrades&#39;).exclude(condition__condition_name=&#39;supported_major_os_upgrades&#39;, condition__condition_data__contains=&#39;10.9&#39;).count()
         c = Context(&#x7b;
            &#39;title&#39;: &#39;10.9 Compatibility&#39;,
            &#39;not_compatible&#39;: not_compatible,
            &#39;page&#39;: page,
            &#39;theid&#39;: theid
        &#x7d;)
        return t.render(c), 3
     def filter_machines(self, machines, data):
        if data == &#39;notcompatible&#39;:
            machines = machines.filter(condition__condition_name=&#39;supported_major_os_upgrades&#39;).exclude(condition__condition_name=&#39;supported_major_os_upgrades&#39;, condition__condition_data__contains=&#39;10.9&#39;)
            title = &#39;Macs not compatible with OS X 10.9&#39;
        else:
            machines = None
            title = None
         return machines, title

You’ll notice that our filter on the machines is pretty much identical to what we were looking for before - that’s because we’re looking for the same machines. We’re taking some input (a bunch of machines, and a string that we’ll come back to), and giving back the machine that fit our search and a title to show at the top of the page.

More templating

So, how did we pass that string? How do we even get to the page where a list of the machines is shown?

We need to edit the templates. First off, the template that is show on the front page of Sal:

grahamgilbert/mavcompatibility/templates/front.html&lt;div class=&quot;span3&quot;&gt;
    &lt;legend&gt;&#x7b;&#x7b; title &#x7d;&#x7d;&lt;/legend&gt;
        &lt;a href=&quot;&#x7b;% url &#39;machine_list_front&#39; &#39;MavCompatibility&#39; &#39;notcompatible&#39; %&#x7d;&quot; class=&quot;btn btn-danger&quot;&gt;
            &lt;span class=&quot;bigger&quot;&gt; &#x7b;&#x7b; not_compatible &#x7d;&#x7d; &lt;/span&gt;&lt;br /&gt;
            Not Compatible
        &lt;/a&gt;
&lt;/div&gt;

The only difference here from last time is we’ve filled out the URL. The options for the first part are machine_list_front or machine_list_id - depending on whether you are coming from the front page (all of the Business Units) or from deeper in the application (the machines are limited), then we’re just passing the name of our plugin.

There isn’t a huge amount you need to change for the other template - just tell Sal what type of page you came from (group or business unit) and the ID of the page you came from.

grahamgilbert/mavcompatibility/templates/id.html&lt;div class=&quot;span3&quot;&gt;
    &lt;legend&gt;&#x7b;&#x7b; title &#x7d;&#x7d;&lt;/legend&gt;
        &lt;a href=&quot;&#x7b;% url &#39;machine_list_id&#39; &#39;MavCompatibility&#39; &#39;notcompatible&#39; page theid %&#x7d;&quot; class=&quot;btn btn-danger&quot;&gt;
            &lt;span class=&quot;bigger&quot;&gt; &#x7b;&#x7b; not_compatible &#x7d;&#x7d; &lt;/span&gt;&lt;br /&gt;
            Not Compatible
        &lt;/a&gt;
&lt;/div&gt;

There you go - a simple plugin for Sal. But don’t go away thinking we’re done. Whilst this is functional, it certainly leaves a fair bit to be desired. In the last part of this series, we’ll tidy everything up.

">
<meta property="og:url" content="http://grahamgilbert.com/blog/2014/02/07/writing-plugins-for-sal-part-2/">
<meta property="og:site_name" content="graham gilbert dot com">

<meta property="og:image" content="http://grahamgilbert.com/images/about.jpg">





<link rel="canonical" href="http://grahamgilbert.com/blog/2014/02/07/writing-plugins-for-sal-part-2/">
<link href="http://grahamgilbert.com/atom.xml" type="application/atom+xml" rel="alternate" title="graham gilbert dot com Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://grahamgilbert.com/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://grahamgilbert.com/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://grahamgilbert.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://grahamgilbert.com/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<link href='/stylesheets/all-476e6a9e20e90d95691860a993d65b96.css' media='all' rel='stylesheet' type='text/css'>
</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<input type="text" class="st-default-search-input" style="width: 150px;">
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="http://grahamgilbert.com/" >Home</a></li>
				
				    
				        
				    
				    <li><a href="http://grahamgilbert.com/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="http://grahamgilbert.com/talks/" >Talks</a></li>
				
				    
				        
				        
				    <li><a href="http://twitter.com/grahamgilbert" target="_blank">Twitter</a></li>
				
				    
				        
				    
				    <li><a href="http://grahamgilbert.com/posts/" >Archives</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    <div itemscope itemtype="http://schema.org/Person">

	<img src="http://grahamgilbert.com/images/about.jpg" class="bio-photo" alt="Graham Gilbert bio photo">


  <h3 itemprop="name">Graham Gilbert</h3>
  <p>A Mac admin, automating the hell out of things in London.<br /><br />The opinions on this site are my own, and are not necessarily shared by my employer.</p>
  <a href="http://twitter.com/grahamgilbert" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/grahamgilbert" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/grahamgilbert" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>
  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://grahamgilbert.com/blog/2014/02/07/writing-plugins-for-sal-part-2/" rel="bookmark" title="Writing Plugins for Sal: Part 2">Writing Plugins for Sal: Part 2</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>And now, time for the shocking second part of our series on how to write plugins for Sal.</p>

<p>In the previous part, we got our basic widget working. This time, we’re going to link it up so we can get lists of those pesky non-10.9 compatible Macs when we click on the button.</p>

<h2 id="its-a-list-jim">It’s a list, Jim</h2>

<p>When displaying the list of machines, Sal will call the <code>filter_machines</code> function in your plugin. I’m sure you don’t want to disappoint, so here’s that function added on to the plugin we wrote last time.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">grahamgilbert/mavcompatibility/mavcompatibility.py</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kn">from</span> <span class="nn">yapsy.IPlugin</span> <span class="kn">import</span> <span class="n">IPlugin</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kn">from</span> <span class="nn">yapsy.PluginManager</span> <span class="kn">import</span> <span class="n">PluginManager</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">loader</span><span class="p">,</span> <span class="n">Context</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kn">from</span> <span class="nn">server.models</span> <span class="kn">import</span> <span class="o">*</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">class</span> <span class="nc">MavCompatibility</span><span class="p">(</span><span class="n">IPlugin</span><span class="p">):</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">def</span> <span class="nf">show_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">machines</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">theid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="s">&#39;front&#39;</span><span class="p">:</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">&#39;grahamgilbert/mavcompatibility/templates/front.html&#39;</span><span class="p">)</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="s">&#39;bu_dashboard&#39;</span><span class="p">:</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">&#39;grahamgilbert/mavcompatibility/templates/id.html&#39;</span><span class="p">)</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="s">&#39;group_dashboard&#39;</span><span class="p">:</span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">&#39;grahamgilbert/mavcompatibility/templates/id.html&#39;</span><span class="p">)</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">not_compatible</span> <span class="o">=</span> <span class="n">machines</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">condition__condition_name</span><span class="o">=</span><span class="s">&#39;supported_major_os_upgrades&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condition__condition_name</span><span class="o">=</span><span class="s">&#39;supported_major_os_upgrades&#39;</span><span class="p">,</span> <span class="n">condition__condition_data__contains</span><span class="o">=</span><span class="s">&#39;10.9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(&#x7b;</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;10.9 Compatibility&#39;</span><span class="p">,</span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="s">&#39;not_compatible&#39;</span><span class="p">:</span> <span class="n">not_compatible</span><span class="p">,</span>
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="s">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="s">&#39;theid&#39;</span><span class="p">:</span> <span class="n">theid</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="p">&#x7d;)</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">3</span>
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">def</span> <span class="nf">filter_machines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machines</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;notcompatible&#39;</span><span class="p">:</span>
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">machines</span> <span class="o">=</span> <span class="n">machines</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">condition__condition_name</span><span class="o">=</span><span class="s">&#39;supported_major_os_upgrades&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">condition__condition_name</span><span class="o">=</span><span class="s">&#39;supported_major_os_upgrades&#39;</span><span class="p">,</span> <span class="n">condition__condition_data__contains</span><span class="o">=</span><span class="s">&#39;10.9&#39;</span><span class="p">)</span>
</div></div><div data-line="33" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Macs not compatible with OS X 10.9&#39;</span>
</div></div><div data-line="34" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">else</span><span class="p">:</span>
</div></div><div data-line="35" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">machines</span> <span class="o">=</span> <span class="bp">None</span>
</div></div><div data-line="36" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
</div></div><div data-line="37" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="38" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">return</span> <span class="n">machines</span><span class="p">,</span> <span class="n">title</span></div></div></pre></div></figure>

<p>You’ll notice that our filter on the machines is pretty much identical to what we were looking for before - that’s because we’re looking for the same machines. We’re taking some input (a bunch of machines, and a string that we’ll come back to), and giving back the machine that fit our search and a title to show at the top of the page.</p>

<h2 id="more-templating">More templating</h2>

<p>So, how did we pass that string? How do we even get to the page where a list of the machines is shown?</p>

<p>We need to edit the templates. First off, the template that is show on the front page of Sal:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">grahamgilbert/mavcompatibility/templates/front.html</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span3&quot;</span><span class="nt">&gt;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="nt">&lt;legend&gt;</span><span class="cp">&#x7b;&#x7b;</span> <span class="nv">title</span> <span class="cp">&#x7d;&#x7d;</span><span class="nt">&lt;/legend&gt;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">&#x7b;%</span> <span class="k">url</span> <span class="s1">&#39;machine_list_front&#39;</span> <span class="s1">&#39;MavCompatibility&#39;</span> <span class="s1">&#39;notcompatible&#39;</span> <span class="cp">%&#x7d;</span><span class="s">&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-danger&quot;</span><span class="nt">&gt;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;bigger&quot;</span><span class="nt">&gt;</span> <span class="cp">&#x7b;&#x7b;</span> <span class="nv">not_compatible</span> <span class="cp">&#x7d;&#x7d;</span> <span class="nt">&lt;/span&gt;&lt;br</span> <span class="nt">/&gt;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">            Not Compatible
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="nt">&lt;/a&gt;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nt">&lt;/div&gt;</span></div></div></pre></div></figure>

<p>The only difference here from last time is we’ve filled out the URL. The options for the first part are <code>machine_list_front</code> or <code>machine_list_id</code> - depending on whether you are coming from the front page (all of the Business Units) or from deeper in the application (the machines are limited), then we’re just passing the name of our plugin.</p>

<p>There isn’t a huge amount you need to change for the other template - just tell Sal what type of page you came from (group or business unit) and the ID of the page you came from.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">grahamgilbert/mavcompatibility/templates/id.html</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;span3&quot;</span><span class="nt">&gt;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="nt">&lt;legend&gt;</span><span class="cp">&#x7b;&#x7b;</span> <span class="nv">title</span> <span class="cp">&#x7d;&#x7d;</span><span class="nt">&lt;/legend&gt;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">&#x7b;%</span> <span class="k">url</span> <span class="s1">&#39;machine_list_id&#39;</span> <span class="s1">&#39;MavCompatibility&#39;</span> <span class="s1">&#39;notcompatible&#39;</span> <span class="nv">page</span> <span class="nv">theid</span> <span class="cp">%&#x7d;</span><span class="s">&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-danger&quot;</span><span class="nt">&gt;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;bigger&quot;</span><span class="nt">&gt;</span> <span class="cp">&#x7b;&#x7b;</span> <span class="nv">not_compatible</span> <span class="cp">&#x7d;&#x7d;</span> <span class="nt">&lt;/span&gt;&lt;br</span> <span class="nt">/&gt;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">            Not Compatible
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="nt">&lt;/a&gt;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nt">&lt;/div&gt;</span></div></div></pre></div></figure>

<p>There you go - a simple plugin for Sal. But don’t go away thinking we’re done. Whilst this is functional, it certainly leaves a fair bit to be desired. In the last part of this series, we’ll tidy everything up.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://grahamgilbert.com/blog/2014/02/07/writing-plugins-for-sal-part-2/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://grahamgilbert.com/blog/2014/02/07/writing-plugins-for-sal-part-2/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://grahamgilbert.com/blog/2014/02/07/writing-plugins-for-sal-part-2/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Writing Plugins for Sal: Part 2</strong> was published on <time datetime="2014-02-07T11:34:24+00:00">February 07, 2014</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://grahamgilbert.com/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://grahamgilbert.com/blog/2016/01/05/dynamic-first-boot-scripts-with-imagr-and-flask/" title="Dynamic first boot scripts with Imagr and Flask">Dynamic first boot scripts with Imagr and Flask</a></li>
    
      <li><a href="http://grahamgilbert.com/blog/2015/12/15/imagr-0-0-5/" title="Imagr 0.0.5">Imagr 0.0.5</a></li>
    
      <li><a href="http://grahamgilbert.com/blog/2015/12/13/automated-timed-releases-with-munki/" title="Automated timed releases with Munki">Automated timed releases with Munki</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    <span>&copy; 2016 Graham Gilbert.</span>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://grahamgilbert.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://grahamgilbert.com/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-27233739-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','sFQe2UApMaKvCdHMFL6r','2.0.0');
</script>
          


  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'grahamgilbert'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</body>
</html>
