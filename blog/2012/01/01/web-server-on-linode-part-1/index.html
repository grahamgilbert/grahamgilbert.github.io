
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Web server on Linode part 1 - graham gilbert</title>
  <meta name="author" content="Graham Gilbert">

  
  <meta name="description" content="Recently, I was tasked with moving a client&rsquo;s web server from a box in their office, to something a little more robust when they put something &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://grahamgilbert.com/blog/2012/01/01/web-server-on-linode-part-1">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="graham gilbert" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@grahamgilbert">
<meta name="twitter:creator" content="@grahamgilbert">
<meta name="twitter:description" content="Mac administration and assorted nerdity">
<meta name="twitter:title" content="grahamgilbert.com">
<meta name="twitter:url" content="http://grahamgilbert.com">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27233739-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">graham gilbert</a></h1>
  
    <h2>Mac administration and assorted nerdity</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:grahamgilbert.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/talks">Talks</a></li>
  <li><a href="http://twitter.com/grahamgilbert">Twitter</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Web Server on Linode Part 1</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-01T20:23:03+00:00" pubdate data-updated="true">Jan 1<span>st</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Recently, I was tasked with moving a client&rsquo;s web server from a box in their office, to something a little more robust when they put something up there that caused the server to go nuts (30 mb/s nuts!).</p>

<p>The main goals were:</p>

<ul>
<li>Fast, scalable web server</li>
<li>Multiple FTP users for the client&rsquo;s web team to modify the site</li>
<li>Integrates with their existing CrashPlan PROe backup system.</li>
<li>Use GUI&rsquo;s as much as possible for admin so lower level techs could make changes on the server.</li>
</ul>


<p>After considering several options, we decided to go with Linode. I&rsquo;ve had great success hosting my own site with them, and as we had full access to the box, we could install anything we wanted &ndash; including CrashPlan.<!--more--></p>

<p>So, first things first. Get yourself a Linode account. Start off with the cheapest 512 account and work your way upwards if you need the horsepower. Once you&rsquo;ve got your account, pick your data centre, and get your VM up and running. We usually go for Ubuntu 10.04 LTS as you&rsquo;ll find the most support online for that.</p>

<p>Now you&rsquo;ve got your Ubuntu Linode up and running, let&rsquo;s get the web server up and running (mostly borrowed from the Linode Library).</p>

<p>It&rsquo;s much easier if you set up an A record for your new VM, so for the purposes of this, we&rsquo;ll call our new VM linode.example.com.</p>

<p>The code-type font is stuff your should be putting into your terminal window, one line at a time (but to be honest, if I have to tell you that, maybe this isn&rsquo;t the right thing to be following&hellip;)</p>

<p>Set the hostname</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="s2">&quot;linode.example.com&quot;</span> &gt; /etc/hostname
</span></code></pre></td></tr></table></div></figure>


<p>Get everything up to date:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apt-get update
</span><span class='line'>apt-get upgrade
</span><span class='line'>apt-get install php5 apache2 mysql-server
</span></code></pre></td></tr></table></div></figure>


<p>Bash in your chosen MySQL root password when you&rsquo;re prompted, and you&rsquo;re done.</p>

<p>That&rsquo;s all you need for the most basic web server, but I&rsquo;m a Mac admin, I quite like having a GUI if I can, so let&rsquo;s get one installed. I quite like webmin, but it&rsquo;s not quite a straightforward as we&rsquo;d like.</p>

<p>First install the dependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apt-get install perl libnet-ssleay-perl openssl libauthen-pam-perl libpam-runtime libio-pty-perl libmd5-perl apt-show-versions libapt-pkg-perl
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll notice there&rsquo;s a failure there, so we&rsquo;ll have to hunt that down ourselves. Grab the latest version from: <a href="http://mirrors.kernel.org/ubuntu/pool/universe/libm/libmd5-perl/">http://mirrors.kernel.org/ubuntu/pool/universe/libm/libmd5-perl/</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /tmp
</span><span class='line'>wget http://mirrors.kernel.org/ubuntu/pool/universe/libm/libmd5-perl/libmd5-perl_2.03-1_all.deb
</span><span class='line'>dpkg -i libmd5-perl_2.03-1_all.deb
</span></code></pre></td></tr></table></div></figure>


<p>Now to grab the latest version of Webmin:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://prdownloads.sourceforge.net/webadmin/webmin_1.570_all.deb
</span><span class='line'>dpkg -i webmin_1.570_all.deb
</span></code></pre></td></tr></table></div></figure>


<p>Now you should be able to log into webmin with your root username and password at <a href="https://linode.example.com:10000">https://linode.example.com:10000</a></p>

<p>I&rsquo;m not going to tell you how to set up Apache &ndash; there&rsquo;s plenty enough on the internet. It&rsquo;s easy with Webmin, the Apache defaults are reasonably sensible. Just make a directory for your web files, and point a new virtual host at the directory. If you get stuck, a good tutorial can be found at <a href="http://doxfer.webmin.com/Webmin/Name-BasedVirtualHosting">http://doxfer.webmin.com/Webmin/Name-BasedVirtualHosting</a></p>

<p>We&rsquo;re nearly done with this part, just a little housekeeping to do. First, a little cleaning up of the MySQL install. Accept the defaults that this script offers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql_secure_installation
</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re going to be running something like Wordpress, chances are you&rsquo;re going to want your server to send emails.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apt-get install exim4
</span><span class='line'>dpkg-reconfigure exim4-config
</span></code></pre></td></tr></table></div></figure>


<p>In the configuration wizard, choose Internet Site for the first option, bash in your Linode&rsquo;s hostname (it should already be there &ndash; if it&rsquo;s not check you&rsquo;ve set the hostname correctly), and make sure that your server will only accept SMTP connections from itself by putting 127.0.0.1 in the next box. In the box asking which domains to accept relays for, enter your Linode&rsquo;s hostname and localhost. Leave the relay domains and relay machines fields blank, and select No when asked about keeping DNS queries down. On the next question on how to store incoming mail, choose whatever you want as you won&rsquo;t be getting any incoming mail here. Finally, accept the default &ldquo;non-split&rdquo; part for how to store the configuration file.</p>

<p>For a little security through obscurity, I like to change the port that webmin listens on as well. Log in, go to Webmin &ndash;> Webmin Configuration &ndash;> Ports and Addresses, and change the listening port to something of your choosing.</p>

<p>Whilst you&rsquo;re there, you might want to change the port that SSH is on as well. In Webmin, you&rsquo;ll want to be looking at Servers &ndash;> SSH Server &ndash;> Networking</p>

<p>Finally, I like to disable the root user. First add your own user (give the user a password etc), then add them to the admin group (the user&rsquo;s in this group are automatically added to sudoers).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adduser myuser
</span><span class='line'>adduser myuser admin
</span></code></pre></td></tr></table></div></figure>


<p>Now log in as your new user and make sure you can sudo &ndash; once that&rsquo;s working, you can disable the root user:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo passwd -l root
</span></code></pre></td></tr></table></div></figure>


<p>Assuming everything is working up to this point, change the DNS for your site to point to your new Linode, sit back and congratulate yourself for giving yourself one less physical box to worry about.</p>

<p>You&rsquo;ve now got a basic webserver up and running on Linode with a GUI to manage the server. Next time, we&rsquo;ll go over setting up an FTP server with virtual users (with a GUI!), and backing up the server with CrashPlan PROe, including performing a full dump of the mysql databases every night so they&rsquo;re backed up properly.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Graham Gilbert</span></span>

      








  


<time datetime="2012-01-01T20:23:03+00:00" pubdate data-updated="true">Jan 1<span>st</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/apache/'>Apache</a>, <a class='category' href='/blog/categories/ubuntu/'>Ubuntu</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://grahamgilbert.com/blog/2012/01/01/web-server-on-linode-part-1/" data-via="grahamgilbert" data-counturl="http://grahamgilbert.com/blog/2012/01/01/web-server-on-linode-part-1/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/12/10/thoughts-on-profile-manager/" title="Previous Post: Thoughts on Profile Manager">&laquo; Thoughts on Profile Manager</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/02/01/making-a-lion-recovery-hd/" title="Next Post: Making a Lion Recovery HD">Making a Lion Recovery HD &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About</h1>
  <p><img src="/images/me.jpg" class="left" />A Mac admin, automating the hell out of things in London. <a href="/about">More?</a></p>

<p class="clear"><small>The opinions on this site are my own, and are not necessarily shared by my employer or clients.</small></p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/27/personal-automation-munki-part-2/">Personal Automation: Munki (Part 2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/26/personal-automation-part-1/">Personal Automation (Part 1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/10/automate-yourself-out-of-a-job/">Automate Yourself Out of a Job</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/09/multi-tenanted-munki-with-puppet-and-sal/">Multi Tenanted Munki With Puppet and Sal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/30/making-packages-with-autopkg/">Making Packages With AutoPkg</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/grahamgilbert">@grahamgilbert</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'grahamgilbert',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Twitter</h1>
<a class="twitter-timeline" href="https://twitter.com/grahamgilbert" data-widget-id="483550747481489408">Tweets by @grahamgilbert</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Graham Gilbert -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'grahamgilbert';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://grahamgilbert.com/blog/2012/01/01/web-server-on-linode-part-1/';
        var disqus_url = 'http://grahamgilbert.com/blog/2012/01/01/web-server-on-linode-part-1/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
