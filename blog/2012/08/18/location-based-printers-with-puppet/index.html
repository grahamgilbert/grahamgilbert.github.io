<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Location based printers with Puppet &middot; graham gilbert dot com
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="http://grahamgilbert.com/atom.xml" title="graham gilbert dot com" />
  <link href='/stylesheets/all-89c2b07b326cd07c6e0562123dce166a.css' media='all' rel='stylesheet' type='text/css'>
</head>

  <body class="theme-base-0d">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
      <p><input type="text" class="st-default-search-input"></p>
    <p>A Mac admin, automating the hell out of things in London.<br /><br />The opinions on this site are my own, and are not necessarily shared by my employer.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
    
      
        
      
    
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
    
      
    
    
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
          <a class="sidebar-nav-item" href="/talks/">Talks</a>
        
      
    

    <a class="sidebar-nav-item" href="https://twitter.com/grahamgilbert">Twitter</a>
    <a class="sidebar-nav-item" href="https://github.com/grahamgilbert">Github</a>

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">graham gilbert dot com</a>
            <small>Mac administration and assorted nerdity</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
    <h1 class="post-title">
      <a href="http://grahamgilbert.com/blog/2012/08/18/location-based-printers-with-puppet/">
        Location based printers with Puppet
      </a>
    </h1>
  <span class="post-date">18 Aug 2012</span>
  <p>This will probably be obvious to most seasoned Puppet inclined OS X admins, but this is a relatively recent revelation for me. Up until very recently, I wasn’t really making full use of Facter, merely pointing my clients to the appropriate classes and leaving it at that. When tasked with giving end users the option to install their own printers when they went to a different site than the one they usually work at, my initial thought was to go for a Payload-free package and pop it into their optional installs in Munki. But then I was asked if it could happen without the user doing anything - they go to the other site, and they automatically get the right printers set up - so after a little thought,  came up with this. I’ve made use of the excellent <a href="https://github.com/mosen/puppet-cups">mosen-puppet-cups</a> module on GitHub to get the printers set up, and the drivers are already deployed with Munki (I did consider moving them to Puppet, but why reinvent the wheel for the sake of it?).</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">case $operatingsystem&#x7b;
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">	Darwin:&#x7b;
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">		##London is on the 10.30.2.0 and 10.30.3.0 Subnets
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">		if ($network_en0 == '10.30.2.0') or ($network_en1 == '10.30.2.0') or ($network_en0 == '10.30.3.0') or ($network_en1 == '10.30.3.0')&#x7b;
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">            	printer &#x7b; "Sharp_ARM316":
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">                	ensure      =&gt; present,
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">			uri         =&gt; "lpd://sharparm316.ldn.example.com",
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">			description =&gt; "Sharp ARM316",
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">			shared      =&gt; false,
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">			ppd         =&gt; "/Library/Printers/PPDs/Contents/Resources/SHARP AR-M316.PPD.gz", # PPD file will be autorequired
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">			&#x7d;
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">		printer &#x7b; "Xerox_WorkCentre_7120":
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">			ensure      =&gt; present,
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">			uri         =&gt; "lpd://xeroxwc7120.ldn.example.com",
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">			description =&gt; "Xerox WorkCentre 7120",
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">			shared      =&gt; false,
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">			ppd         =&gt; "/Library/Printers/PPDs/Contents/Resources/Xerox WorkCentre 7120.gz", # PPD file will be autorequired
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">			&#x7d;
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">		&#x7d;
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">		##San Francisco is on the 10.30.10.0 Subnet
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line">		if ($network_en0 == '10.30.10.0') or ($network_en1 == '10.30.10.0')&#x7b;
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line"> 		printer &#x7b; "Xerox_550":
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">			ensure      =&gt; present,
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line">			uri         =&gt; "lpd://xerox550.sf.example.com",
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line">			description =&gt; "Xerox 550",
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line">			shared      =&gt; false,
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line">			ppd         =&gt; "/Library/Printers/PPDs/Contents/Resources/en.lproj/Xerox 550-560 Integrated Fiery", # PPD file will be autorequired
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line">			&#x7d;
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line">		&#x7d;
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line">	&#x7d;
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line">&#x7d;</div></div></pre></div></figure>


  <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//grahamgilbert.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/2016/06/21/hands-on-with-imagr-at-macdevops-yvr/">
            Hands on with Imagr at MacDevOps:YVR
            <small>21 Jun 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/06/01/imagr-1-1-1/">
            Imagr 1.1.1
            <small>01 Jun 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/05/11/conference-season-2016/">
            Conference Season 2016
            <small>11 May 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  <script type="text/javascript">
   (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
   (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
   e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
   })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

   _st('install','sFQe2UApMaKvCdHMFL6r','2.0.0');
 </script>
  </body>
</html>
