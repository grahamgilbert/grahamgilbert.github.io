<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Getting started with Puppet on OS X (part 1) &middot; graham gilbert dot com
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="http://grahamgilbert.com/atom.xml" title="graham gilbert dot com" />
  <link href='/stylesheets/all-89c2b07b326cd07c6e0562123dce166a.css' media='all' rel='stylesheet' type='text/css'>
</head>

  <body class="theme-base-0d">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
      <p><input type="text" class="st-default-search-input"></p>
    <p>A Mac admin, automating the hell out of things in London.<br /><br />The opinions on this site are my own, and are not necessarily shared by my employer.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
    
      
        
      
    
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
    
      
    
    
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
      
    
    
      
        
          <a class="sidebar-nav-item" href="/talks/">Talks</a>
        
      
    

    <a class="sidebar-nav-item" href="https://twitter.com/grahamgilbert">Twitter</a>
    <a class="sidebar-nav-item" href="https://github.com/grahamgilbert">Github</a>

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">graham gilbert dot com</a>
            <small>Mac administration and assorted nerdity</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
    <h1 class="post-title">
      <a href="http://grahamgilbert.com/blog/2013/01/25/getting-started-with-puppet-part-1/">
        Getting started with Puppet on OS X (part 1)
      </a>
    </h1>
  <span class="post-date">25 Jan 2013</span>
  <p>When I was first getting started, the first hurdle I had to get over was trying to work out how it would apply to what I do - manage Macs. There are plenty of resources on managing servers with Puppet, but precious little on using Puppet with OS X - so, here’s how to get started with Puppet.
<!-- more -->
First off, grab yourself the Puppet Enterprise demo VM from the <a href="http://puppetlabs.com">Puppet Labs</a> site - setting up your own Puppet Master is beyond the scope of these articles.</p>

<p>You will also need either a Mac running OS X 10.8 you don’t mind (possibly) nuking, or preferably a virtual machine, so you can reset it easily.</p>

<p>I’m using VMWare Fusion here - please translate the commands to whatever virtualisation app you’re using.</p>

<h2 id="some-setup-on-the-puppet-master">Some setup on the Puppet Master</h2>
<p>There are a couple of things we need to do to the Puppet Master before we get stuck in with configuring our Mac client. First, change the networking settings so that it appears directly on your network. The default for the VMWare VM is NAT - this won’t work for us. Now you can boot it up and SSH into it - if you wait for a minute or two, the IP address of the VM will be displayed on the screen.</p>

<p>The VM you’ve downloaded is Puppet Enterprise - this is the paid for version of Puppet, that ships pre-configured. We use the open source version, which requires some assembly on the server end (which I will hopefully cover one day). As it’s Puppet Enterprise, it comes with the Dashboard all ready to use - we won’t be using it here, so don’t worry about it. All we want is the IP address.</p>

<p><img class="center" src="/images/posts/2013-01-25/Learning_Puppet_VM__(PE_2.7.0).png" alt="" /></p>

<p>So, let’s get into the box:</p>

<pre><code>ssh root@192.168.3.149
</code></pre>

<p>The password will be <em>puppet</em></p>

<p>As I mentioned above, being Puppet Enterprise, there are a few differences - the biggest one as far as we’re concerned is that the actual Puppet files are in a different location - we’ll create a symlink to the “normal” place for Puppet Open Source:</p>

<pre><code>ln -s /etc/puppetlabs/puppet /etc/puppet
</code></pre>

<p>This is optional, but I recommend it, as I will be referring to all paths on the Puppet Master based in this symlink being in place.</p>

<p>Now, onto the Mac - first things first, get SSH turned on - open System Preferences -&gt; Sharing and check Remote Login. Once again, not essential, but it will make your life much easier.</p>

<p>In the real world, you would set up a DNS entry for your Puppet Master - it’s likely you won’t want to do this when you’re just testing out, so let’s fake it. Either SSH into your Mac, or just open terminal and issue:</p>

<pre><code>sudo nano /etc/hosts
</code></pre>

<p>You can of course, use whatever text editor you want to - if you’ve not used nano before, here’s a one line crash course: ctrl + O writes the file (you can change the name or just press return and confirm you want to overwrite the file) and ctrl + x to exit. There are more functions of course, but this will get you started enough for this article.</p>

<p>Scroll down to the bottom and put in an entry for your Puppet server’s IP address:</p>

<p><img class="center" src="/images/posts/2013-01-25/host_edit.png" alt="" /></p>

<p>Still with me? Good, it’s time to install Puppet and Facter. Head on over to <a href="http://downloads.puppetlabs.com/mac">the Puppet Labs download</a> page and get the latest versions of Puppet and Facter (3.0.2 and 1.6.17 respectively) and install them on your test Mac. Or if you’re still SSH’ed into the Mac, you can run this command (which will download and install both Puppet and Facter).</p>

<pre><code>curl -s https://raw.github.com/grahamgilbert/macscripts/master/Puppet-Install/install_puppet.py | sudo python
</code></pre>

<p>Cushty, Puppet and Facter are installed. Puppet won’t do much though until we write it’s configuration file. I’m going to call the Mac puppetclient here.  Pop <code>sudo nano /etc/puppet/puppet.conf</code> in the Mac’s terminal window and paste in the following and save it:</p>
<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line">[main]
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">logdir=/var/log/puppet
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">vardir=/var/lib/puppet
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">ssldir=/var/lib/puppet/ssl
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">#rundir=/var/run/puppet
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">factpath=$vardir/lib/facter
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">templatedir=$confdir/templates
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">[master]
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"># These are needed when the puppet master is run by passenger
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"># and can safely be removed if webrick is used.
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">ssl_client_header = SSL_CLIENT_S_DN 
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">ssl_client_verify_header = SSL_CLIENT_VERIFY
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">[agent]
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">##This is the name of our server
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">server=puppet
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">##This is where we specify the name of our client
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">certname=puppetclient
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line">report=true
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line">pluginsync=true</div></div></pre></div></figure>

<p>We’re now ready to get our client talking to the server. Make sure you’ve got SSH sessions open to both the client and server, as we’ll need to work on both.</p>

<p>On the Mac:</p>

<pre><code>sudo puppet agent --server puppet --waitforcert 60 --test --group 0
</code></pre>

<p>And on the Puppet Master we want to list all of the certificates waiting to be signed:</p>

<pre><code>puppet cert --list
</code></pre>

<p>Once you see your puppetclient’s certificate waiting to be signed, sign it on the Master with:</p>

<pre><code>puppet cert --sign puppetclient
</code></pre>

<p>After a few seconds you will then see loads of output scrolling along. This is Puppet starting to work it’s magic - although Puppet won’t do anything yet, as you’ve not described any configuration for the client - yet. We’ll do that next time.</p>

<p>Apologies for the slightly boring post, but you’ve done the hard part now, it’s all good from here!</p>

<p><a href="/blog/2013/01/27/getting-started-with-puppet-on-os-x-part-2/">Onwards to part 2!</a></p>

  <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//grahamgilbert.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/2016/05/05/getting-started-as-a-mac-admin/">
            Getting started as a Mac admin
            <small>05 May 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/03/30/managing-os-x-profiles-with-puppet/">
            Managing OS X Profiles with Puppet
            <small>30 Mar 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/02/10/macad-uk-2016-puppet-on-os-x/">
            MacAD.UK 2016&#58; Puppet on OS X
            <small>10 Feb 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  <script type="text/javascript">
   (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
   (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
   e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
   })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

   _st('install','sFQe2UApMaKvCdHMFL6r','2.0.0');
 </script>
  </body>
</html>
