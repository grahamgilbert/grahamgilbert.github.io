<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Getting Started With Puppet on OS X (Part 3) &#8211; graham gilbert dot com</title>
<meta name="description" content="In this post, we’ll do something pretty much all Mac admins will need to do - set up their admin user. Bust first, a little housekeeping.

Before reading this post, you really need to read part 1, part 2 and most importantly my post on building a Puppet Master with Vagrant. The Puppet Labs provided VM won’t cut it here, we need the latest version of Puppet on our Master. If you are using the same Mac / OS X VM that was previously hooked up to the Puppet Master VM, you will need to run the following command on the client - don’t worry, it will get new certificates from your very own Puppet Master:

sudo rm -rf /var/lib/puppet/ssl


Make sure your test Mac is pointing to the right server - unless you’ve changed your Vagrantfile, your Puppet Master’s IP address will be 192.168.33.10 - you will need to change your test Mac’s /etc/hosts file to reflect this change.

Updates from the previous post: Since the last post was published, Puppet version 3.1 has been released - the main bonus to Mac users is that the Puppet user and group are now created, so the manual Puppet run command is a little shorter. What was this:

sudo puppet agent --test --group 0


Can now be shortened to:

sudo puppet agent --test


As the Puppet user and group now exist, you no longer need to run Puppet as root. This creates another issue (the Puppet user is visible at the login screen despite it not being able to log in), but we’ll get around that in this article. Regardless, you want to install Puppet 3.1. Back to the main event.

First thing’s first, create your admin user. I’ve called mine “Local Administrator”, with a short name of “ladmin” and the very imaginative passord of “password”. Next open up a Terminal window on your puppetclient Mac and issue the following command:

sudo puppet resource user ladmin


You’ll see output similar to this:

site.ppuser &#x7b; &#39;ladmin&#39;:
  ensure     =&gt; &#39;present&#39;,
  comment    =&gt; &#39;Local Admin&#39;,
  gid        =&gt; &#39;20&#39;,
  groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  home       =&gt; &#39;/Users/ladmin&#39;,
  iterations =&gt; &#39;21881&#39;,
  password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  shell      =&gt; &#39;/bin/bash&#39;,
  uid        =&gt; &#39;502&#39;,
&#x7d;

That looks suspiciously like Puppet code. Let’s try it.

With the Vagrant based Puppet Master, the manifests file that previously lived at /etc/puppet/manifests is now located on your Mac at puppet/manifests (as is the modules folder, Vagrant takes care of linking it to the right place on the VM). Open up puppet/manifests/sites.pp in your favourite text editor (for the love of all that’s holy, please don’t use TextEdit. Try TextWrangler, or my current favourite Chocolat).

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
  		gid    =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/Users/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;502&#39;,
	&#x7d;
&#x7d;

Save it, and then back on your client perform a Puppet run:

sudo puppet agent --test


Of course nothing has changed - that’s because your client’s configuration is how you have described it in site.pp. Try changing ladmin’s password in system preferences, then perform another Puppet run. You’ll see Puppet change the password right back.

Now we’ve got our Local Admin user working, it might be nice to hide it away from inquisitive users. The first step is to change our Local Admin’s UID to something lower than 500 - I like 404 (nerd joke), and then for good measure, we’ll move the home folder out of /Users and into /var.

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
  		gid        =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/var/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;404&#39;,
	&#x7d;
&#x7d;

That gets the home folder moved, now to actually hide the home folder. Add this just before the closing } (curly bracket) in your site.pp:

site.ppexec &#x7b;&#39;Hide sub-500 users&#39;:
        command =&gt; &quot;/usr/bin/defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE&quot;,
        &#x7d;

When you perform a Puppet run, you’ll notice that your command is run every time, regardless of whether it needs to. We only really need to run that when we change our Local Admin user. To do that, we’ll change two lines. When the Admin User changes, we’ll send a signal to the exec, and we’ll change the exec to only run when it is told to.

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
		gid        =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/var/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;404&#39;,
  		notify     =&gt; Exec[&#39;Hide sub-500 users&#39;],
	&#x7d;
 	    exec &#x7b;&#39;Hide sub-500 users&#39;:
        command =&gt; &quot;/usr/bin/defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE&quot;,
        refreshonly =&gt; true,
        &#x7d;
&#x7d;

Save it, and perform a Puppet run on your client.You’ll notice that the defaults command is now only run when Puppet needs to modify the user.

Next time, we’ll be taking a look at Modules - pre-built bits of Puppet code that you can plug into your workflow to save you re-inventing the wheel.

">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Getting Started With Puppet on OS X (Part 3)">
<meta name="twitter:description" content="In this post, we’ll do something pretty much all Mac admins will need to do - set up their admin user. Bust first, a little housekeeping.

Before reading this post, you really need to read part 1, part 2 and most importantly my post on building a Puppet Master with Vagrant. The Puppet Labs provided VM won’t cut it here, we need the latest version of Puppet on our Master. If you are using the same Mac / OS X VM that was previously hooked up to the Puppet Master VM, you will need to run the following command on the client - don’t worry, it will get new certificates from your very own Puppet Master:

sudo rm -rf /var/lib/puppet/ssl


Make sure your test Mac is pointing to the right server - unless you’ve changed your Vagrantfile, your Puppet Master’s IP address will be 192.168.33.10 - you will need to change your test Mac’s /etc/hosts file to reflect this change.

Updates from the previous post: Since the last post was published, Puppet version 3.1 has been released - the main bonus to Mac users is that the Puppet user and group are now created, so the manual Puppet run command is a little shorter. What was this:

sudo puppet agent --test --group 0


Can now be shortened to:

sudo puppet agent --test


As the Puppet user and group now exist, you no longer need to run Puppet as root. This creates another issue (the Puppet user is visible at the login screen despite it not being able to log in), but we’ll get around that in this article. Regardless, you want to install Puppet 3.1. Back to the main event.

First thing’s first, create your admin user. I’ve called mine “Local Administrator”, with a short name of “ladmin” and the very imaginative passord of “password”. Next open up a Terminal window on your puppetclient Mac and issue the following command:

sudo puppet resource user ladmin


You’ll see output similar to this:

site.ppuser &#x7b; &#39;ladmin&#39;:
  ensure     =&gt; &#39;present&#39;,
  comment    =&gt; &#39;Local Admin&#39;,
  gid        =&gt; &#39;20&#39;,
  groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  home       =&gt; &#39;/Users/ladmin&#39;,
  iterations =&gt; &#39;21881&#39;,
  password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  shell      =&gt; &#39;/bin/bash&#39;,
  uid        =&gt; &#39;502&#39;,
&#x7d;

That looks suspiciously like Puppet code. Let’s try it.

With the Vagrant based Puppet Master, the manifests file that previously lived at /etc/puppet/manifests is now located on your Mac at puppet/manifests (as is the modules folder, Vagrant takes care of linking it to the right place on the VM). Open up puppet/manifests/sites.pp in your favourite text editor (for the love of all that’s holy, please don’t use TextEdit. Try TextWrangler, or my current favourite Chocolat).

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
  		gid    =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/Users/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;502&#39;,
	&#x7d;
&#x7d;

Save it, and then back on your client perform a Puppet run:

sudo puppet agent --test


Of course nothing has changed - that’s because your client’s configuration is how you have described it in site.pp. Try changing ladmin’s password in system preferences, then perform another Puppet run. You’ll see Puppet change the password right back.

Now we’ve got our Local Admin user working, it might be nice to hide it away from inquisitive users. The first step is to change our Local Admin’s UID to something lower than 500 - I like 404 (nerd joke), and then for good measure, we’ll move the home folder out of /Users and into /var.

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
  		gid        =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/var/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;404&#39;,
	&#x7d;
&#x7d;

That gets the home folder moved, now to actually hide the home folder. Add this just before the closing } (curly bracket) in your site.pp:

site.ppexec &#x7b;&#39;Hide sub-500 users&#39;:
        command =&gt; &quot;/usr/bin/defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE&quot;,
        &#x7d;

When you perform a Puppet run, you’ll notice that your command is run every time, regardless of whether it needs to. We only really need to run that when we change our Local Admin user. To do that, we’ll change two lines. When the Admin User changes, we’ll send a signal to the exec, and we’ll change the exec to only run when it is told to.

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
		gid        =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/var/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;404&#39;,
  		notify     =&gt; Exec[&#39;Hide sub-500 users&#39;],
	&#x7d;
 	    exec &#x7b;&#39;Hide sub-500 users&#39;:
        command =&gt; &quot;/usr/bin/defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE&quot;,
        refreshonly =&gt; true,
        &#x7d;
&#x7d;

Save it, and perform a Puppet run on your client.You’ll notice that the defaults command is now only run when Puppet needs to modify the user.

Next time, we’ll be taking a look at Modules - pre-built bits of Puppet code that you can plug into your workflow to save you re-inventing the wheel.

">
<meta name="twitter:site" content="@grahamgilbert">
<meta name="twitter:creator" content="@grahamgilbert">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://grahamgilbert.com/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="article">
<meta property="og:title" content="Getting Started With Puppet on OS X (Part 3)">
<meta property="og:description" content="In this post, we’ll do something pretty much all Mac admins will need to do - set up their admin user. Bust first, a little housekeeping.

Before reading this post, you really need to read part 1, part 2 and most importantly my post on building a Puppet Master with Vagrant. The Puppet Labs provided VM won’t cut it here, we need the latest version of Puppet on our Master. If you are using the same Mac / OS X VM that was previously hooked up to the Puppet Master VM, you will need to run the following command on the client - don’t worry, it will get new certificates from your very own Puppet Master:

sudo rm -rf /var/lib/puppet/ssl


Make sure your test Mac is pointing to the right server - unless you’ve changed your Vagrantfile, your Puppet Master’s IP address will be 192.168.33.10 - you will need to change your test Mac’s /etc/hosts file to reflect this change.

Updates from the previous post: Since the last post was published, Puppet version 3.1 has been released - the main bonus to Mac users is that the Puppet user and group are now created, so the manual Puppet run command is a little shorter. What was this:

sudo puppet agent --test --group 0


Can now be shortened to:

sudo puppet agent --test


As the Puppet user and group now exist, you no longer need to run Puppet as root. This creates another issue (the Puppet user is visible at the login screen despite it not being able to log in), but we’ll get around that in this article. Regardless, you want to install Puppet 3.1. Back to the main event.

First thing’s first, create your admin user. I’ve called mine “Local Administrator”, with a short name of “ladmin” and the very imaginative passord of “password”. Next open up a Terminal window on your puppetclient Mac and issue the following command:

sudo puppet resource user ladmin


You’ll see output similar to this:

site.ppuser &#x7b; &#39;ladmin&#39;:
  ensure     =&gt; &#39;present&#39;,
  comment    =&gt; &#39;Local Admin&#39;,
  gid        =&gt; &#39;20&#39;,
  groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  home       =&gt; &#39;/Users/ladmin&#39;,
  iterations =&gt; &#39;21881&#39;,
  password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  shell      =&gt; &#39;/bin/bash&#39;,
  uid        =&gt; &#39;502&#39;,
&#x7d;

That looks suspiciously like Puppet code. Let’s try it.

With the Vagrant based Puppet Master, the manifests file that previously lived at /etc/puppet/manifests is now located on your Mac at puppet/manifests (as is the modules folder, Vagrant takes care of linking it to the right place on the VM). Open up puppet/manifests/sites.pp in your favourite text editor (for the love of all that’s holy, please don’t use TextEdit. Try TextWrangler, or my current favourite Chocolat).

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
  		gid    =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/Users/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;502&#39;,
	&#x7d;
&#x7d;

Save it, and then back on your client perform a Puppet run:

sudo puppet agent --test


Of course nothing has changed - that’s because your client’s configuration is how you have described it in site.pp. Try changing ladmin’s password in system preferences, then perform another Puppet run. You’ll see Puppet change the password right back.

Now we’ve got our Local Admin user working, it might be nice to hide it away from inquisitive users. The first step is to change our Local Admin’s UID to something lower than 500 - I like 404 (nerd joke), and then for good measure, we’ll move the home folder out of /Users and into /var.

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
  		gid        =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/var/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;404&#39;,
	&#x7d;
&#x7d;

That gets the home folder moved, now to actually hide the home folder. Add this just before the closing } (curly bracket) in your site.pp:

site.ppexec &#x7b;&#39;Hide sub-500 users&#39;:
        command =&gt; &quot;/usr/bin/defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE&quot;,
        &#x7d;

When you perform a Puppet run, you’ll notice that your command is run every time, regardless of whether it needs to. We only really need to run that when we change our Local Admin user. To do that, we’ll change two lines. When the Admin User changes, we’ll send a signal to the exec, and we’ll change the exec to only run when it is told to.

site.ppnode puppetclient &#x7b;
	user &#x7b; &#39;ladmin&#39;:
  		ensure     =&gt; &#39;present&#39;,
  		comment    =&gt; &#39;Local Admin&#39;,
		gid        =&gt; &#39;20&#39;,
  		groups     =&gt; [&#39;_appserveradm&#39;, &#39;_appserverusr&#39;, &#39;_lpadmin&#39;, &#39;admin&#39;],
  		home       =&gt; &#39;/var/ladmin&#39;,
  		iterations =&gt; &#39;21881&#39;,
  		password   =&gt; &#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;,
  		salt       =&gt; &#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;,
  		shell      =&gt; &#39;/bin/bash&#39;,
  		uid        =&gt; &#39;404&#39;,
  		notify     =&gt; Exec[&#39;Hide sub-500 users&#39;],
	&#x7d;
 	    exec &#x7b;&#39;Hide sub-500 users&#39;:
        command =&gt; &quot;/usr/bin/defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE&quot;,
        refreshonly =&gt; true,
        &#x7d;
&#x7d;

Save it, and perform a Puppet run on your client.You’ll notice that the defaults command is now only run when Puppet needs to modify the user.

Next time, we’ll be taking a look at Modules - pre-built bits of Puppet code that you can plug into your workflow to save you re-inventing the wheel.

">
<meta property="og:url" content="http://grahamgilbert.com/blog/2013/02/24/getting-started-with-puppet-on-os-x-part-3/">
<meta property="og:site_name" content="graham gilbert dot com">

<meta property="og:image" content="http://grahamgilbert.com/images/default-thumb.png">





<link rel="canonical" href="http://grahamgilbert.com/blog/2013/02/24/getting-started-with-puppet-on-os-x-part-3/">
<link href="http://grahamgilbert.com/atom.xml" type="application/atom+xml" rel="alternate" title="graham gilbert dot com Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://grahamgilbert.com/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://grahamgilbert.com/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://grahamgilbert.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://grahamgilbert.com/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://grahamgilbert.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://grahamgilbert.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://grahamgilbert.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://grahamgilbert.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://grahamgilbert.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://grahamgilbert.com/images/apple-touch-icon-144x144-precomposed.png">
<link href='/stylesheets/all-476e6a9e20e90d95691860a993d65b96.css' media='all' rel='stylesheet' type='text/css'>
</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://grahamgilbert.com/">graham gilbert dot com</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="http://grahamgilbert.com/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="http://grahamgilbert.com/talks/" >Talks</a></li>
				
				    
				        
				        
				    <li><a href="http://twitter.com/grahamgilbert" target="_blank">Twitter</a></li>
				
				    
				        
				    
				    <li><a href="http://grahamgilbert.com/posts/" >Archives</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    <div itemscope itemtype="http://schema.org/Person">


	<img src="http://grahamgilbert.com/images/about.jpg" class="bio-photo" alt="Graham Gilbert bio photo">


  <h3 itemprop="name">Graham Gilbert</h3>
  <p>A Mac admin, automating the hell out of things in London.<br /><br />The opinions on this site are my own, and are not necessarily shared by my employer.</p>
  <a href="http://twitter.com/grahamgilbert" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/grahamgilbert" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/grahamgilbert" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>
  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://grahamgilbert.com/blog/2013/02/24/getting-started-with-puppet-on-os-x-part-3/" rel="bookmark" title="Getting Started With Puppet on OS X (Part 3)">Getting Started With Puppet on OS X (Part 3)</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>In this post, we’ll do something pretty much all Mac admins will need to do - set up their admin user. Bust first, a little housekeeping.</p>

<p>Before reading this post, you really need to read <a href="http://grahamgilbert.com/blog/2013/01/25/getting-started-with-puppet-part-1/">part 1</a>, <a href="http://grahamgilbert.com/blog/2013/01/27/getting-started-with-puppet-on-os-x-part-2/">part 2</a> and most importantly my post on <a href="http://grahamgilbert.com/blog/2013/02/13/building-a-test-puppet-master-with-vagrant/">building a Puppet Master with Vagrant</a>. The Puppet Labs provided VM won’t cut it here, we need the latest version of Puppet on our Master. If you are using the same Mac / OS X VM that was previously hooked up to the Puppet Master VM, you will need to run the following command on the client - don’t worry, it will get new certificates from your very own Puppet Master:</p>

<pre><code>sudo rm -rf /var/lib/puppet/ssl
</code></pre>

<p>Make sure your test Mac is pointing to the right server - unless you’ve changed your Vagrantfile, your Puppet Master’s IP address will be 192.168.33.10 - you will need to change your test Mac’s /etc/hosts file to reflect this change.</p>

<p><strong>Updates from the previous post:</strong> Since the last post was published, Puppet version 3.1 has been released - the main bonus to Mac users is that the Puppet user and group are now created, so the manual Puppet run command is a little shorter. What was this:</p>

<pre><code>sudo puppet agent --test --group 0
</code></pre>

<p>Can now be shortened to:</p>

<pre><code>sudo puppet agent --test
</code></pre>

<p>As the Puppet user and group now exist, you no longer need to run Puppet as root. This creates another issue (the Puppet user is visible at the login screen despite it not being able to log in), but we’ll get around that in this article. Regardless, you want to install <a href="http://downloads.puppetlabs.com/mac/">Puppet 3.1</a>. Back to the main event.</p>

<p>First thing’s first, create your admin user. I’ve called mine “Local Administrator”, with a short name of “ladmin” and the very imaginative passord of “password”. Next open up a Terminal window on your puppetclient Mac and issue the following command:</p>

<pre><code>sudo puppet resource user ladmin
</code></pre>

<p>You’ll see output similar to this:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">site.pp</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">user</span> <span class="p">&#x7b;</span> <span class="s1">&#39;ladmin&#39;</span><span class="p">:</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">ensure</span>     <span class="o">=&gt;</span> <span class="s1">&#39;present&#39;</span><span class="p">,</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">comment</span>    <span class="o">=&gt;</span> <span class="s1">&#39;Local Admin&#39;</span><span class="p">,</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">gid</span>        <span class="o">=&gt;</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">groups</span>     <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;_appserveradm&#39;</span><span class="p">,</span> <span class="s1">&#39;_appserverusr&#39;</span><span class="p">,</span> <span class="s1">&#39;_lpadmin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="o">]</span><span class="p">,</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">home</span>       <span class="o">=&gt;</span> <span class="s1">&#39;/Users/ladmin&#39;</span><span class="p">,</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">iterations</span> <span class="o">=&gt;</span> <span class="s1">&#39;21881&#39;</span><span class="p">,</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">password</span>   <span class="o">=&gt;</span> <span class="s1">&#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;</span><span class="p">,</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">salt</span>       <span class="o">=&gt;</span> <span class="s1">&#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;</span><span class="p">,</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">shell</span>      <span class="o">=&gt;</span> <span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">uid</span>        <span class="o">=&gt;</span> <span class="s1">&#39;502&#39;</span><span class="p">,</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>That looks suspiciously like Puppet code. Let’s try it.</p>

<p>With the Vagrant based Puppet Master, the manifests file that previously lived at /etc/puppet/manifests is now located on your Mac at puppet/manifests (as is the modules folder, Vagrant takes care of linking it to the right place on the VM). Open up puppet/manifests/sites.pp in your favourite text editor (for the love of all that’s holy, please don’t use TextEdit. Try TextWrangler, or my current favourite <a href="http://www.chocolatapp.com/">Chocolat</a>).</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">site.pp</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">node</span> <span class="n">puppetclient</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">	<span class="n">user</span> <span class="p">&#x7b;</span> <span class="s1">&#39;ladmin&#39;</span><span class="p">:</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="k">ensure</span>     <span class="o">=&gt;</span> <span class="s1">&#39;present&#39;</span><span class="p">,</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">comment</span>    <span class="o">=&gt;</span> <span class="s1">&#39;Local Admin&#39;</span><span class="p">,</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">gid</span>    <span class="o">=&gt;</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">groups</span>     <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;_appserveradm&#39;</span><span class="p">,</span> <span class="s1">&#39;_appserverusr&#39;</span><span class="p">,</span> <span class="s1">&#39;_lpadmin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="o">]</span><span class="p">,</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">home</span>       <span class="o">=&gt;</span> <span class="s1">&#39;/Users/ladmin&#39;</span><span class="p">,</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">iterations</span> <span class="o">=&gt;</span> <span class="s1">&#39;21881&#39;</span><span class="p">,</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">password</span>   <span class="o">=&gt;</span> <span class="s1">&#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;</span><span class="p">,</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">salt</span>       <span class="o">=&gt;</span> <span class="s1">&#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;</span><span class="p">,</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">shell</span>      <span class="o">=&gt;</span> <span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">uid</span>        <span class="o">=&gt;</span> <span class="s1">&#39;502&#39;</span><span class="p">,</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">	<span class="p">&#x7d;</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>Save it, and then back on your client perform a Puppet run:</p>

<pre><code>sudo puppet agent --test
</code></pre>

<p>Of course nothing has changed - that’s because your client’s configuration is how you have described it in site.pp. Try changing ladmin’s password in system preferences, then perform another Puppet run. You’ll see Puppet change the password right back.</p>

<p>Now we’ve got our Local Admin user working, it might be nice to hide it away from inquisitive users. The first step is to change our Local Admin’s UID to something lower than 500 - I like 404 (nerd joke), and then for good measure, we’ll move the home folder out of /Users and into /var.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">site.pp</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">node</span> <span class="n">puppetclient</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">	<span class="n">user</span> <span class="p">&#x7b;</span> <span class="s1">&#39;ladmin&#39;</span><span class="p">:</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="k">ensure</span>     <span class="o">=&gt;</span> <span class="s1">&#39;present&#39;</span><span class="p">,</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">comment</span>    <span class="o">=&gt;</span> <span class="s1">&#39;Local Admin&#39;</span><span class="p">,</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">gid</span>        <span class="o">=&gt;</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">groups</span>     <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;_appserveradm&#39;</span><span class="p">,</span> <span class="s1">&#39;_appserverusr&#39;</span><span class="p">,</span> <span class="s1">&#39;_lpadmin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="o">]</span><span class="p">,</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">home</span>       <span class="o">=&gt;</span> <span class="s1">&#39;/var/ladmin&#39;</span><span class="p">,</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">iterations</span> <span class="o">=&gt;</span> <span class="s1">&#39;21881&#39;</span><span class="p">,</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">password</span>   <span class="o">=&gt;</span> <span class="s1">&#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;</span><span class="p">,</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">salt</span>       <span class="o">=&gt;</span> <span class="s1">&#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;</span><span class="p">,</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">shell</span>      <span class="o">=&gt;</span> <span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">uid</span>        <span class="o">=&gt;</span> <span class="s1">&#39;404&#39;</span><span class="p">,</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">	<span class="p">&#x7d;</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>That gets the home folder moved, now to actually hide the home folder. Add this just before the closing } (curly bracket) in your site.pp:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">site.pp</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nb">exec</span> <span class="p">&#x7b;</span><span class="s1">&#39;Hide sub-500 users&#39;</span><span class="p">:</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;/usr/bin/defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE&quot;</span><span class="p">,</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>When you perform a Puppet run, you’ll notice that your command is run every time, regardless of whether it needs to. We only really need to run that when we change our Local Admin user. To do that, we’ll change two lines. When the Admin User changes, we’ll send a signal to the exec, and we’ll change the exec to only run when it is told to.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">site.pp</span></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">node</span> <span class="n">puppetclient</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">	<span class="n">user</span> <span class="p">&#x7b;</span> <span class="s1">&#39;ladmin&#39;</span><span class="p">:</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="k">ensure</span>     <span class="o">=&gt;</span> <span class="s1">&#39;present&#39;</span><span class="p">,</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">comment</span>    <span class="o">=&gt;</span> <span class="s1">&#39;Local Admin&#39;</span><span class="p">,</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">		<span class="n">gid</span>        <span class="o">=&gt;</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">groups</span>     <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;_appserveradm&#39;</span><span class="p">,</span> <span class="s1">&#39;_appserverusr&#39;</span><span class="p">,</span> <span class="s1">&#39;_lpadmin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="o">]</span><span class="p">,</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">home</span>       <span class="o">=&gt;</span> <span class="s1">&#39;/var/ladmin&#39;</span><span class="p">,</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">iterations</span> <span class="o">=&gt;</span> <span class="s1">&#39;21881&#39;</span><span class="p">,</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">password</span>   <span class="o">=&gt;</span> <span class="s1">&#39;401e3aa796b3bfff2c8e929a003b727be1bd548aa0f0b0e131f0d11f3953162be210200a70872734a28be747a933e12e2458ffdcc60d209eab9e006a9f4042dc883148070e6e8ad05f4a5e5d44bd0ddfc9494482f0d16c9d5eb1de086183db1b89df9982d2856eeed431d65e03ff99177c3185aa61bc926b1a0020c49621ddd8&#39;</span><span class="p">,</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">salt</span>       <span class="o">=&gt;</span> <span class="s1">&#39;0c3cd42b97d0b0df45542fcb5961a2920f2fd6204aa151bf08d762d9dd44fd0c&#39;</span><span class="p">,</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">shell</span>      <span class="o">=&gt;</span> <span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">uid</span>        <span class="o">=&gt;</span> <span class="s1">&#39;404&#39;</span><span class="p">,</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">  		<span class="n">notify</span>     <span class="o">=&gt;</span> <span class="no">Exec</span><span class="o">[</span><span class="s1">&#39;Hide sub-500 users&#39;</span><span class="o">]</span><span class="p">,</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">	<span class="p">&#x7d;</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">	    <span class="nb">exec</span> <span class="p">&#x7b;</span><span class="s1">&#39;Hide sub-500 users&#39;</span><span class="p">:</span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;/usr/bin/defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE&quot;</span><span class="p">,</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">refreshonly</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="p">&#x7d;</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>Save it, and perform a Puppet run on your client.You’ll notice that the defaults command is now only run when Puppet needs to modify the user.</p>

<p>Next time, we’ll be taking a look at Modules - pre-built bits of Puppet code that you can plug into your workflow to save you re-inventing the wheel.</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://grahamgilbert.com/blog/2013/02/24/getting-started-with-puppet-on-os-x-part-3/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://grahamgilbert.com/blog/2013/02/24/getting-started-with-puppet-on-os-x-part-3/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://grahamgilbert.com/blog/2013/02/24/getting-started-with-puppet-on-os-x-part-3/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Getting Started With Puppet on OS X (Part 3)</strong> was published on <time datetime="2013-02-24T14:59:00+00:00">February 24, 2013</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://grahamgilbert.com/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://grahamgilbert.com/blog/2015/11/23/releasing-changes-with-sharding/" title="Releasing Changes With Sharding">Releasing Changes With Sharding</a></li>
    
      <li><a href="http://grahamgilbert.com/blog/2015/11/12/mactech-2015-hands-on-with-imagr/" title="MacTech 2015: Hands on with Imagr">MacTech 2015: Hands on with Imagr</a></li>
    
      <li><a href="http://grahamgilbert.com/blog/2015/10/15/detecting-when-a-munki-client-is-on-the-corporate-network/" title="Detecting when a Munki client is on the corporate network">Detecting when a Munki client is on the corporate network</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    <span>&copy; 2015 Graham Gilbert. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://grahamgilbert.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://grahamgilbert.com/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-27233739-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'grahamgilbert'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</body>
</html>
