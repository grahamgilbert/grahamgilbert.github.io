<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: munki | graham gilbert]]></title>
  <link href="http://grahamgilbert.com/blog/categories/munki/atom.xml" rel="self"/>
  <link href="http://grahamgilbert.com/"/>
  <updated>2015-11-12T19:44:01+00:00</updated>
  <id>http://grahamgilbert.com/</id>
  <author>
    <name><![CDATA[Graham Gilbert]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Detecting when a Munki client is on the corporate network]]></title>
    <link href="http://grahamgilbert.com/blog/2015/10/15/detecting-when-a-munki-client-is-on-the-corporate-network/"/>
    <updated>2015-10-15T12:37:34+01:00</updated>
    <id>http://grahamgilbert.com/blog/2015/10/15/detecting-when-a-munki-client-is-on-the-corporate-network</id>
    <content type="html"><![CDATA[<p>Sometimes it is useful to know whether a Munki client is on your corporate network &ndash; you might have a package or script that will only work when able to access an internal resource, or you might just want statistics on which users are accessing your internal infrastructure and external infrastructure.</p>

<p>The idea is to have your clients attempt to access a URL that they will only have access to when they&rsquo;re on your internal network. This URL should return the following plist when the client accesses it:</p>

<p>``` xml
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo;?>
&lt;!DOCTYPE plist PUBLIC &ldquo;&ndash;//Apple//DTD PLIST 1.0//EN&rdquo; &ldquo;<a href="http://www.apple.com/DTDs/PropertyList-1.0.dtd">http://www.apple.com/DTDs/PropertyList-1.0.dtd</a>&rdquo;>
<plist version="1.0">
<dict></p>

<pre><code>&lt;key&gt;response&lt;/key&gt;
&lt;string&gt;active&lt;/string&gt;
</code></pre>

<p></dict>
</plist>
```</p>

<h2>The condition script</h2>

<p>You can find the condition script on <a href="https://github.com/grahamgilbert/munki_conditions/tree/master/on_corp">my Github</a>. You should modify <a href="https://github.com/grahamgilbert/munki_conditions/blob/master/on_corp/on_corp.py#L11">line 11</a> of that script to point to your plist, and you can then distribute it to your clients however you wish (a Makefile for <a href="https://github.com/unixorn/luggage">The Luggage</a> is in the repo).</p>

<p>When all is running, you will have access to an <code>on_corp</code> condition for use in your manifests.</p>

<p>``` xml
<key>conditional_items</key>
<array></p>

<pre><code>&lt;dict&gt;
  &lt;key&gt;condition&lt;/key&gt;
  &lt;string&gt;on_corp == TRUE&lt;/string&gt;
  &lt;key&gt;managed_installs&lt;/key&gt;
  &lt;array&gt;
      &lt;string&gt;MyOnCorpOnlyPackage&lt;/string&gt;
  &lt;/array&gt;
&lt;/dict&gt;
</code></pre>

<p> </array>
```</p>

<p>Or if your Munki reporting tool supports using data from Conditions (like <a href="https://github.com/salopensource/sal">Sal</a>!), you could display that infomation in a <a href="https://github.com/salopensource/grahamgilbert-plugins/tree/master/oncorp">plugin</a>.</p>

<p><img class="center" src="/images/posts/2015-10-15/Sal_plugin.png" width="290" height="133"></p>
]]></content>
  </entry>
  
</feed>
