<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: AutoPkg | graham gilbert]]></title>
  <link href="http://grahamgilbert.com/blog/categories/autopkg/atom.xml" rel="self"/>
  <link href="http://grahamgilbert.com/"/>
  <updated>2015-11-12T19:44:01+00:00</updated>
  <id>http://grahamgilbert.com/</id>
  <author>
    <name><![CDATA[Graham Gilbert]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Making packages with AutoPkg]]></title>
    <link href="http://grahamgilbert.com/blog/2014/06/30/making-packages-with-autopkg/"/>
    <updated>2014-06-30T10:12:10+01:00</updated>
    <id>http://grahamgilbert.com/blog/2014/06/30/making-packages-with-autopkg</id>
    <content type="html"><![CDATA[<p>Over the past few weeks, I&rsquo;ve had the same conversation over and over:
people telling me that once they get started using Munki, their next
step will be to start using AutoPkg. I gave each person the same
response: &ldquo;you&rsquo;re doing it wrong&rdquo;.</p>

<p>AutoPkg a has a reputation of being difficult to use. This is totally
unjustfied. You don&rsquo;t need to be using Munki for it to be useful, you
don&rsquo;t need to set it up to run automatically via Jenkins or a
LaunchDaemon. If you need to get software into a package,  AutoPkg is
the easiest way.</p>

<h2>Installing AutoPkg</h2>

<p>Head over to the <a href="https://github.com/autopkg/autopkg/releases/latest">releases page on AutoPkg&rsquo;s GitHub repository</a> and
download the latest version  (0.3.0 at the time of writing). It&rsquo;s an
Apple package, so double click it and get it installed. If you have Gate Keeper enabled, you&rsquo;ll need to right-click on the package and choose to install it from there, as it&rsquo;s not been signed.</p>

<h2>Recipes</h2>

<p>AutoPkg is useless without recipes. Fortunately, there are hundreds
that have already been made by the community.</p>

<p>We&rsquo;ll add the set of recipes maintained by AutoPkg&rsquo;s authors, which
contains some of the most common software. Open up a terminal window
and enter :</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>autopkg repo-add &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://github.com/autopkg/recipes&quot;</span>&gt;https://github.com/autopkg/recipes&lt;/a&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You&rsquo;ll see AutoPkg downloading and adding the recipes to your Mac.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Attempting git clone&amp;hellip;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Adding /Users/grahamgilbert/Library/AutoPkg/RecipeRepos/com.github.autopkg.recipes to RECIPE_SEARCH_DIRS&amp;hellip;
</span><span class='line'>Updated search path:
</span><span class='line'>  &amp;lsquo;.&amp;rsquo;
</span><span class='line'>  &amp;lsquo;~/Library/AutoPkg/Recipes&amp;rsquo;
</span><span class='line'>  &amp;lsquo;/Library/AutoPkg/Recipes&amp;rsquo;
</span><span class='line'>  &amp;lsquo;/Users/vagrant/Library/AutoPkg/RecipeRepos/com.github.autopkg.recipes&amp;rsquo;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Using the thing</h2>

<p>Let&rsquo;s see what recipes we just added. Still in your terminal, enter:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>autopkg list-recipes
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You&rsquo;ll see a whole load of output like:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Adium.download
</span><span class='line'>Adium.munki
</span><span class='line'>Adium.pkg
</span><span class='line'>AdobeAIR.pkg
</span><span class='line'>AdobeAcrobatPro9Update.download
</span><span class='line'>AdobeAcrobatPro9Update.munki
</span><span class='line'>AdobeAcrobatProXUpdate.download
</span><span class='line'>AdobeAcrobatProXUpdate.munki
</span><span class='line'>AdobeAir.munki
</span><span class='line'>AdobeFlashPlayer.download
</span><span class='line'>AdobeFlashPlayer.munki
</span><span class='line'>AdobeFlashPlayer.pkg
</span><span class='line'>AdobeFlashPlayerExtractPackage.munki
</span><span class='line'>&amp;hellip;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The naming convention in AutoPKG is SoftwareName.output. For for
example, to run a recipe that downloads Google Chrome and adds it to
Munki, you would use the GoogleChrome.munki recipe, but if you just
wanted to download it an make a package, you&rsquo;d use the GoogleChrome.pkg recipe. It just so happens that making a package of Chrome is exactly what we want to do.</p>

<p>Back into your terminal and enter:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>autopkg run GoogleChrome.pkg
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The AutoPkg robot will churn away and you&rsquo;ll get some output similar to:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Processing GoogleChrome.pkg&amp;hellip;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;The following new items were downloaded:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;/Users/grahamgilbert/Library/AutoPkg/Cache/com.github.autopkg.pkg.googlechrome/downloads/GoogleChrome.dmg
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;The following packages were built:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;Identifier               Version          Pkg path
</span><span class='line'>----------               -------          --------
</span><span class='line'>com.google.Chrome        35.0.1916.153    /Users/grahamgilbert/Library/AutoPkg/Cache/com.github.autopkg.pkg.googlechrome/GoogleChrome-35.0.1916.153.pkg
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And when it&rsquo;s all finished, you&rsquo;ll be left with a nice package that
you can use anywhere you&rsquo;d use finely crafted packages &ndash; ARD, AutoDMG or even Casper if you&rsquo;re that way inclined (although Allister Banks has been
working on a way of automating importing packages into the JSS &ndash; see
his <a href="http://tmblr.co/ZHT_Wy1J-Hk5I">recent talk</a> for more on that subject).</p>

<h2>Doing it all again</h2>

<p>What happens next time you want to build an updated package?</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>autopkg run GoogleChrome.pkg
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Right?</p>

<p>Well, kinda.</p>

<p>What happens if Google changes the URL AutoPkg uses to download
Chrome? Fortunately we&rsquo;re using the community provided recipes, and if
something&rsquo;s broken they usually get fixed pretty quickly. We just need
to tell AutoPkg to update the installed recipes.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>autopkg update-repo all
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And then we&rsquo;re able to build our package safe in the knowledge that
someone else has done all of the hard work for us.</p>
]]></content>
  </entry>
  
</feed>
